<!doctype html><html lang=en-us><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><link rel=preload as=font href=https://pkel.github.io/cpr/fonts/vendor/jost/jost-v4-latin-regular.woff2 type=font/woff2 crossorigin><link rel=preload as=font href=https://pkel.github.io/cpr/fonts/vendor/jost/jost-v4-latin-500.woff2 type=font/woff2 crossorigin><link rel=preload as=font href=https://pkel.github.io/cpr/fonts/vendor/jost/jost-v4-latin-700.woff2 type=font/woff2 crossorigin><link rel=preload as=font href=https://pkel.github.io/cpr/fonts/KaTeX_Main-Regular.woff2 type=font/woff2 crossorigin><link rel=preload as=font href=https://pkel.github.io/cpr/fonts/KaTeX_Math-Italic.woff2 type=font/woff2 crossorigin><link rel=stylesheet href=https://pkel.github.io/cpr/main.8f2e5b3e67a391b1d4a67752fea6ff750627b78087e30698a55d4e16479632e6b13baf1866de3ffc8aa3690c5b1aac09f78c169eb50f37955b5f1fc41fc909a2.css integrity="sha512-jy5bPmejkbHUpndS/qb/dQYnt4CH4waYpV1OFkeWMuaxO68YZt4//IqjaQxbGqwJ94wWnrUPN5VbXx/EH8kJog==" crossorigin=anonymous><noscript><style>img.lazyload{display:none}</style></noscript><meta name=robots content="index, follow"><meta name=googlebot content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1"><meta name=bingbot content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1"><title>Generalizing Selfish Mining's Gamma - CPR</title><meta name=description content="We discuss a popular network assumption made in the Selfish Mining
literature against Nakamoto consensus. We derive an equivalent but
more general network assumption which can be used with any protocol
and other attacks than Selfish Mining.
"><link rel=canonical href=https://pkel.github.io/cpr/blog/generalizing-selfish-minings-gamma/><meta property="og:locale" content><meta property="og:type" content="article"><meta property="og:title" content="Generalizing Selfish Mining's Gamma"><meta property="og:description" content="We discuss a popular network assumption made in the Selfish Mining
literature against Nakamoto consensus. We derive an equivalent but
more general network assumption which can be used with any protocol
and other attacks than Selfish Mining.
"><meta property="og:url" content="https://pkel.github.io/cpr/blog/generalizing-selfish-minings-gamma/"><meta property="og:site_name" content="CPR"><meta property="article:published_time" content="2022-12-16T00:00:00+00:00"><meta property="article:modified_time" content="2023-01-20T11:55:42+01:00"><meta property="og:image" content="https://pkel.github.io/cpr/blog/generalizing-selfish-minings-gamma/stable-diffusion.png"><meta name=twitter:card content="summary_large_image"><meta name=twitter:site content><meta name=twitter:creator content><meta name=twitter:title content="Generalizing Selfish Mining's Gamma"><meta name=twitter:description content="We discuss a popular network assumption made in the Selfish Mining
literature against Nakamoto consensus. We derive an equivalent but
more general network assumption which can be used with any protocol
and other attacks than Selfish Mining.
"><meta name=twitter:image content="https://pkel.github.io/cpr/blog/generalizing-selfish-minings-gamma/stable-diffusion.png"><meta name=twitter:image:alt content="Generalizing Selfish Mining's Gamma"><script type=application/ld+json>{"@context":"https://schema.org","@graph":[{"@type":"Person","@id":"https://pkel.github.io/#/schema/person/1","name":"CPR","url":"https://pkel.github.io/","sameAs":["https://github.com/pkel/cpr"],"image":{"@type":"ImageObject","@id":"https://pkel.github.io/#/schema/image/1","url":"https://pkel.github.io/\u003cnil\u003e","width":null,"height":null,"caption":"CPR"}},{"@type":"WebSite","@id":"https://pkel.github.io/#/schema/website/1","url":"https://pkel.github.io/","name":"CPR","description":"CPR provides tools for specifying, simulating, and attacking proof-of-work consensus protocols like Bitcoin and Ethereum.","publisher":{"@id":"https://pkel.github.io/#/schema/person/1"}},{"@type":"WebPage","@id":"https://pkel.github.io/cpr/blog/generalizing-selfish-minings-gamma/","url":"https://pkel.github.io/cpr/blog/generalizing-selfish-minings-gamma/","name":"Generalizing Selfish Mining\u0027s Gamma","description":"We discuss a popular network assumption made in the Selfish Mining\nliterature against Nakamoto consensus. We derive an equivalent but\nmore general network assumption which can be used with any protocol\nand other attacks than Selfish Mining.\n","isPartOf":{"@id":"https://pkel.github.io/#/schema/website/1"},"about":{"@id":"https://pkel.github.io/#/schema/person/1"},"datePublished":"2022-12-16T00:00:00CET","dateModified":"2023-01-20T11:55:42CET","breadcrumb":{"@id":"https://pkel.github.io/cpr/blog/generalizing-selfish-minings-gamma/#/schema/breadcrumb/1"},"primaryImageOfPage":{"@id":"https://pkel.github.io/cpr/blog/generalizing-selfish-minings-gamma/#/schema/image/2"},"inLanguage":"en-US","potentialAction":[{"@type":"ReadAction","target":["https://pkel.github.io/cpr/blog/generalizing-selfish-minings-gamma/"]}]},{"@type":"BreadcrumbList","@id":"https://pkel.github.io/cpr/blog/generalizing-selfish-minings-gamma/#/schema/breadcrumb/1","name":"Breadcrumbs","itemListElement":[{"@type":"ListItem","position":1,"item":{"@type":"WebPage","@id":"https://pkel.github.io/cpr/","url":"https://pkel.github.io/cpr/","name":"Home"}},{"@type":"ListItem","position":2,"item":{"@type":"WebPage","@id":"https://pkel.github.io/cpr/blog/","url":"https://pkel.github.io/cpr/blog/","name":"Blog"}},{"@type":"ListItem","position":3,"item":{"@id":"https://pkel.github.io/cpr/blog/generalizing-selfish-minings-gamma/"}}]},{"@context":"https://schema.org","@graph":[{"@type":"Article","@id":"https://pkel.github.io/#/schema/article/1","headline":"Generalizing Selfish Mining\u0027s Gamma","description":"We discuss a popular network assumption made in the Selfish Mining\nliterature against Nakamoto consensus. We derive an equivalent but\nmore general network assumption which can be used with any protocol\nand other attacks than Selfish Mining.\n","isPartOf":{"@id":"https://pkel.github.io/cpr/blog/generalizing-selfish-minings-gamma/"},"mainEntityOfPage":{"@id":"https://pkel.github.io/cpr/blog/generalizing-selfish-minings-gamma/"},"datePublished":"2022-12-16T00:00:00CET","dateModified":"2023-01-20T11:55:42CET","author":{"@id":"https://pkel.github.io/#/schema/person/2"},"publisher":{"@id":"https://pkel.github.io/#/schema/person/1"},"image":{"@id":"https://pkel.github.io/cpr/blog/generalizing-selfish-minings-gamma/#/schema/image/2"}}]},{"@context":"https://schema.org","@graph":[{"@type":"Person","@id":"https://pkel.github.io/#/schema/person/2","name":"Patrik Keller","sameAs":["https://github.com/pkel"]}]},{"@context":"https://schema.org","@graph":[{"@type":"ImageObject","@id":"https://pkel.github.io/cpr/blog/generalizing-selfish-minings-gamma/#/schema/image/2","url":null,"contentUrl":null,"caption":"Generalizing Selfish Mining\u0027s Gamma"}]}]}</script><meta name=theme-color content="#fff"><link rel=icon href=https://pkel.github.io/cpr/favicon.ico sizes=any><link rel=apple-touch-icon sizes=180x180 href=https://pkel.github.io/cpr/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=https://pkel.github.io/cpr/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=https://pkel.github.io/cpr/favicon-16x16.png><link rel=manifest crossorigin=use-credentials href=https://pkel.github.io/cpr/site.webmanifest></head><body class="blog single"><div class=sticky-top><div class=header-bar></div><header class="navbar navbar-expand-lg navbar-light doks-navbar"><nav class="container-xxl flex-wrap flex-lg-nowrap" aria-label="Main navigation"><a class="navbar-brand order-0" href=/ aria-label=CPR>CPR</a>
<button class="btn btn-menu order-2 d-block d-lg-none" type=button data-bs-toggle=offcanvas data-bs-target=#offcanvasDoks aria-controls=offcanvasDoks aria-label="Open main menu"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="18" x2="21" y2="18"/></svg></button><div class="offcanvas offcanvas-end border-0 py-lg-1" tabindex=-1 id=offcanvasDoks data-bs-backdrop=true aria-labelledby=offcanvasDoksLabel><div class="header-bar d-lg-none"></div><div class="offcanvas-header d-lg-none"><h2 class="h5 offcanvas-title ps-2" id=offcanvasDoksLabel><a class=text-dark href=/>CPR</a></h2><button type=button class="btn-close text-reset me-2" data-bs-dismiss=offcanvas aria-label="Close main menu"></button></div><div class="offcanvas-body p-4 p-lg-0"><ul class="nav flex-column flex-lg-row align-items-lg-center mt-2 mt-lg-0 ms-lg-2 me-lg-auto"><li class=nav-item><a class="nav-link ps-0 py-1" href=/cpr/docs/prologue/introduction/>Docs</a></li><li class=nav-item><a class="nav-link ps-0 py-1 active" href=/cpr/blog/>Blog</a></li></ul><hr class="text-black-50 my-4 d-lg-none"><form class="doks-search position-relative flex-grow-1 ms-lg-auto me-lg-2"><input id=search class="form-control is-search" type=search placeholder="Search docs..." aria-label="Search docs..." autocomplete=off><div id=suggestions class="shadow bg-white rounded d-none"></div></form><hr class="text-black-50 my-4 d-lg-none"><ul class="nav flex-column flex-lg-row"><li class=nav-item><a class="nav-link social-link" href=https://github.com/pkel/cpr><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-github"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77 5.44 5.44.0 003.5 8.55c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg><small class="ms-2 d-lg-none">GitHub</small></a></li></ul></div></div></nav></header></div><div class="wrap container-xxl" role=document><div class=content><article><div class="row justify-content-center"><div class="col-md-12 col-lg-10"><div class=blog-header><h1>Generalizing Selfish Mining's Gamma</h1><p><small>Posted&nbsp;in&nbsp;<a class="stretched-link position-relative link-muted" href=https://pkel.github.io/categories/constructions/>Constructions</a>&nbsp;on&nbsp;December 16, 2022 by <a class="stretched-link position-relative" href=/contributors/patrik-keller/>Patrik Keller</a>&nbsp;&dash;&nbsp;<strong>10&nbsp;min read</strong></small><p></div></div><div class=col-md-13><div><figure class=figure><img class="figure-img img-fluid lazyload blur-up" data-sizes=auto src=https://pkel.github.io/cpr/blog/generalizing-selfish-minings-gamma/stable-diffusion_hu9cd47732d72be4b3f92178ab44062003_969431_2d150fcaf132d7b9796ee316283a9d09.png data-srcset="https://pkel.github.io/cpr/blog/generalizing-selfish-minings-gamma/stable-diffusion_hu9cd47732d72be4b3f92178ab44062003_969431_81a9332c56855615cc8938e01edc79b9.png 900w,https://pkel.github.io/cpr/blog/generalizing-selfish-minings-gamma/stable-diffusion_hu9cd47732d72be4b3f92178ab44062003_969431_9645e3596579027a2bfe3d75a3aa4f42.png 800w,https://pkel.github.io/cpr/blog/generalizing-selfish-minings-gamma/stable-diffusion_hu9cd47732d72be4b3f92178ab44062003_969431_5536411c78f4a8be72c2443dd47c67c1.png 700w,https://pkel.github.io/cpr/blog/generalizing-selfish-minings-gamma/stable-diffusion_hu9cd47732d72be4b3f92178ab44062003_969431_792f4bc0e10f90d8d00f8f9e8688cf48.png 600w,https://pkel.github.io/cpr/blog/generalizing-selfish-minings-gamma/stable-diffusion_hu9cd47732d72be4b3f92178ab44062003_969431_b82a8af8bcae769e775a2bcb975cddc5.png 500w" width=1270 height=715 alt="Generalizing Selfish Mining's Gamma"><noscript><img class="figure-img img-fluid" sizes=100vw srcset="https://pkel.github.io/cpr/blog/generalizing-selfish-minings-gamma/stable-diffusion_hu9cd47732d72be4b3f92178ab44062003_969431_81a9332c56855615cc8938e01edc79b9.png 900w,https://pkel.github.io/cpr/blog/generalizing-selfish-minings-gamma/stable-diffusion_hu9cd47732d72be4b3f92178ab44062003_969431_9645e3596579027a2bfe3d75a3aa4f42.png 800w,https://pkel.github.io/cpr/blog/generalizing-selfish-minings-gamma/stable-diffusion_hu9cd47732d72be4b3f92178ab44062003_969431_5536411c78f4a8be72c2443dd47c67c1.png 700w,https://pkel.github.io/cpr/blog/generalizing-selfish-minings-gamma/stable-diffusion_hu9cd47732d72be4b3f92178ab44062003_969431_792f4bc0e10f90d8d00f8f9e8688cf48.png 600w,https://pkel.github.io/cpr/blog/generalizing-selfish-minings-gamma/stable-diffusion_hu9cd47732d72be4b3f92178ab44062003_969431_b82a8af8bcae769e775a2bcb975cddc5.png 500w" src=https://pkel.github.io/cpr/blog/generalizing-selfish-minings-gamma/stable-diffusion_hu9cd47732d72be4b3f92178ab44062003_969431_1270x715_fill_box_center_3.png width=1270 height=715 alt="Generalizing Selfish Mining's Gamma"></noscript></figure></div></div><div class="col-md-12 col-lg-9"><p><strong>TL;DR:</strong> We discuss a popular network assumption made in the Selfish
Mining literature against Nakamoto consensus. We derive an equivalent
but more general network assumption which can be used with any protocol
and other attacks than Selfish Mining.</p><h2 id=selfish-minings-gamma-parameter>Selfish Mining&rsquo;s Gamma Parameter <a href=#selfish-minings-gamma-parameter class=anchor aria-hidden=true>#</a></h2><p>In their original work on Selfish Mining against <a href=/cpr/docs/protocols/nakamoto/>Nakamoto
consensus</a>, Eyal and Sirer (2014) make the
following network assumption. What they refer to as <em>&#171;selfish pool&#187;</em>
would be called attacker in our notation.</p><blockquote><p>If the [selfish] pool has a private branch of length 1 and the others
mine one block, the pool publishes its branch immediately, which results
in two public branches of length 1. Miners in the selfish pool all mine
on the pool’s branch, because a subsequent block discovery on this
branch will yield a reward for the pool. The honest miners, following
the standard Bitcoin protocol implementation, mine on the branch they
heard of first. We denote by $\gamma$ the ratio of honest miners that
choose to mine on the pool’s block, and the other $(1 - \gamma)$ of the
non-pool miners mine on the other branch.</p></blockquote><p>In their follow-up work, Sapirshtein et al. (2016) summarise as follows.</p><blockquote><p>$\gamma$ is a parameter representing the communication capabilities of
the attacker—the fraction of nodes to which it manages to send blocks
first in case of a block race.</p></blockquote><p>I like this approach because it reduces a wide variety of possible
network conditions into a single, explainable parameter. The big
drawback is the close coupling of the definition with the <a href=/cpr/docs/protocols/nakamoto/>attacked
protocol</a> and the corresponding attack
space.</p><h2 id=cprs-generic-network>CPR&rsquo;s Generic Network <a href=#cprs-generic-network class=anchor aria-hidden=true>#</a></h2><p><a href=/cpr/docs/methods/simulator/>CPR&rsquo;s simulator</a> has a generic interface to
support a wide variety of network assumptions. Nodes have outgoing
connections. If a node shares a block, it will be disseminated across
these connections. Message delays can be controlled individually per
sending node, outgoing connection, and message.</p><figure style=width:100%><div class=text-center><img src=net4.png alt="Fully-connected network with 4 nodes"></div><figcaption>CPR network example. Circles represent nodes, arrows represent outgoing
connections. The four nodes are fully connected, thus message
forwarding is not necessary.</figcaption></figure><p>In the remainder of this post, I will describe how to model CPR networks
that exhibit a given $\gamma.$ We can then use these networks to
reproduce the existing Selfish Mining results against <a href=/cpr/docs/protocols/nakamoto/>Nakamoto
consensus</a> within CPR. Even better, we can
launch other attacks against any specified protocol while keeping the
network assumptions compatible with the Selfish Mining literature.</p><h2 id=reordering-messages>Reordering Messages <a href=#reordering-messages class=anchor aria-hidden=true>#</a></h2><p>In the Selfish Mining literature, $\gamma$ represents the share of
defenders (weighted by hash-rate) who adopt the attacker&rsquo;s block in case
of a block race. The term <em>block race</em> refers to a situation where one
of the honest nodes mines a new block $b_0$ while the attacker already
has mined&mdash;but kept private&mdash;a block $b_1$ of the same height. If the
attacker decides to release $b_1$ at the very same time it is not
obvious how the defenders will react. The <a href=/cpr/docs/protocols/nakamoto/>protocol</a> prescribes to prefer the block first received, but this
depends on individual message propagation delays. Attackers with
network-level capabilities can delay propagation of $b_0$ and hence make
the defenders prefer the attacker&rsquo;s block $b_1$. The prevalent
assumption is that, after each block race, $\gamma$ of the defender&rsquo;s
hash-rate is used to mine on $b_1$, the rest on $b_0$.</p><p>This attack relies on what BFT researches would typically call <em>message
reordering</em>. The honest miner sends $b_0$ before the attacker sends
$b_1$, but (some of) the remaining defender nodes receive $b_1$ before
$b_0$. The $\gamma$ parameter abstractly defines how often the
reordering succeeds.
Based on this more general notion of message reordering, we can derive a
CPR network exhibiting a given $\gamma$.</p><h2 id=constructing-a-network>Constructing a Network <a href=#constructing-a-network class=anchor aria-hidden=true>#</a></h2><p>We start by imposing a couple of restrictions on the design space.
First, the network should consist of $n \geq 3$ nodes. We need one
attacker and at least two defenders&mdash;one sends a message before the
attacker does, the other receives the two messages in potentially
reversed order. Second, all defenders have the same hash-rate. Third,
the nodes are fully-connected, that is, each node has outgoing
connections to all other nodes. Forth, the attacker receives all
messages immediately. Fifth, message delays between defenders are
constant but small, let&rsquo;s say $\varepsilon$. Sixth, all outgoing
connections from the attacker to defender have the same properties.</p><figure style=width:100%><div class=text-center><img src=net4+links.png alt="Restricted network"></div><figcaption>Example network with $n = 4$ nodes. Node 0 is the only malicious node.
Nodes 1 to 3 are defender nodes. Propagation delay from defender to
attacker (green) is zero; from defender to defender (blue) it's
$\varepsilon$. We'll choose the propagation delay from attacker to
defender (red) to meet a certain $\gamma$.</figcaption></figure><p>With these restrictions in place, we have only one dimension left. How
do we have to delay messages from attacker to defender, such that
$\gamma$ of the block races end in favor of the attacker?</p><p>We have one attacker node and $n - 1$ defender nodes. One of the
defenders sends a message&mdash;in Selfish Mining that would be a freshly
mined block. The other $n - 2$ defenders receive the message after
$\varepsilon$ time. The attacker receives it immediately, sends another
message&mdash;usually a competing block&mdash;to the $n-2$ receiving defenders,
and hopes that it gets there first, that is, faster than $\varepsilon$
time.</p><p>Let&rsquo;s rename the nodes such that $0$ is the attacker and node $1$ is the
sending defender node. Nodes $2$ to $n$ are about to receive the
messages sent by nodes $0$ and $1$. Then, we introduce a couple of
random variables. $D_i$ is the random message delay from the attacker
$0$ to defender $i$. We assume that $D_i$ is uniformly distributed
between $0$ and $d$. $X_i$ is one if node $i$ receives the attackers
message first and zero otherwise. $X$ describes how many defenders
receive the attacker&rsquo;s message first. All of this applied in reverse
order yields</p><p>$$
E[X]
= \sum_{n=2}^{n-1} E[X_i]
= \sum_{n=2}^{n-1} P[D_i &lt; \varepsilon]
= \sum_{n=2}^{n-1} \frac{\varepsilon}{d}
= (n - 2) \cdot \frac{\varepsilon}{d}
\quad.
$$</p><p>Now, recall that $\gamma$ represents the number of nodes who mine on the
attacker&rsquo;s block after the block race. In other words, we want $\gamma$
of the defenders to receive the attacker&rsquo;s message first. Mathematically
speaking,</p><p>$$
\frac{E[X]}{n - 1} \stackrel{!}{=} \gamma \quad.
$$</p><p>Substituting $E[X]$ from above and resolving for $d$ yields</p><p>$$
d = \frac{n - 2}{n - 1} \cdot \frac{\varepsilon}{\gamma} \quad.
$$</p><p>Following this reasoning backwards implies that if the message delays
from attacker to defender are independently drawn from the continuous
uniform distribution on the interval $[0, \frac{n - 2}{n - 1} \cdot
\frac{\varepsilon}{\gamma}]$, then the network is compatible with the
$\gamma$-assumption in Selfish Mining.</p><h2 id=limiting-gamma>Limiting Gamma <a href=#limiting-gamma class=anchor aria-hidden=true>#</a></h2><p>Related literature evaluates Selfish Mining for $\gamma = 1$.
This is not possible with our approach. But $\gamma = 1$ is also
not possible in practice.</p><p>The reason is that in any block race one of the honest nodes has mined
the block which the attacker tries to match. This honest node will never
accept the attacker&rsquo;s competing block. Instead, it will continue mining
on the honest block.</p><p>The same is true for message reordering. In order to craft a competing
message, the attacker has to know the message. While the sending
defender has not yet sent the message, the attacker cannot react to it.
Hence, the sender of the message cannot receive the attacker&rsquo;s message
first.</p><p>In our network with $n-1$ defenders this manifest as follows. After any
block race, $\frac{1}{n-1}$ of the defenders&rsquo; hash-rate will be used to mine
on the honest block. Consequently, $\gamma$ must be lower or equal $1 -
\frac{1}{n-1} = \frac{n-2}{n-1}$. Thus, in order to emulate a given
$\gamma$ we have to simulate at least $n \geq \frac{1}{1 - \gamma}+ 1$
nodes. Setting $\gamma = 1$ implies $n = \infty$ and makes simulations
unfeasible.</p><p>Astute readers will now (at the latest) start questioning the formulas
in the previous section. Why does the limitation presented here not show
up above? It&rsquo;s because one of the steps above requires qualification. We
used that $D_i$ is uniformly distributed on the interval from $0$ to
$d$. Then we said that $P[D_i &lt; \varepsilon] = \frac{\varepsilon}{d}$.
That&rsquo;s true if $d \geq \varepsilon$ but otherwise the probability is
$1$. As a result, $E[X] \leq n-2$ and $\gamma \leq \frac{n-2}{n-1}$.</p><p>In the real world, most of the hash-rate is concentrated around a few
nodes. In December 2022, the two biggest Bitcoin mining pools have 26%
and 19% of the overall hash-rate. Let&rsquo;s assume the bigger one turns
malicious and starts selfish mining. That leaves 74% of the hash-rate to
the defender, of which about 26% belong to the second-biggest miner (the
19% one). In 26% of the block races, the second-biggest miner will be
the sender of the block which the attacker tries to outrun. So in 26% of
the cases 26% of the defender hash-rate will not mine on the attacker&rsquo;s
block. This alone makes any $\gamma > 0.94$ unrealistic.</p><h2 id=choosing-parameters>Choosing Parameters <a href=#choosing-parameters class=anchor aria-hidden=true>#</a></h2><p>So far, we&rsquo;ve used three network parameters: number of nodes $n$,
attacker&rsquo;s communication capability $\gamma$, and defenders
communication delay $\varepsilon$. A full <a href=/cpr/docs/methods/simulator/>network
description</a>
additionally sets the attacker&rsquo;s relative hash-rate $\alpha$, and the
network&rsquo;s overall mining rate $\lambda$.</p><p>A couple of restrictions follow either from the definitions of the
parameters themselves or from the construction above.</p><ul><li>Gamma and alpha are fractions, thus $0 \leq \gamma \leq 1$ and $0 \leq
\alpha \leq 1$.</li><li>Defender communication has to be delayed at least a bit, thus $0 &lt; \varepsilon$.</li><li>Network size must be at least $\max(3, \frac{1}{1 - \gamma} + 1) \leq
n$.</li></ul><p>Attacker capabilities, $\alpha$ and $\gamma$, are typically higher level
assumption. It&rsquo;s safe to assume that the analyst knows how to set them.
It&rsquo;s less clear how to set $\lambda$, $\varepsilon$, and $n$ because
these parameters are not present in Selfish Mining.</p><p>$\varepsilon$ slows down the communication between the defenders. The
construction needs some positive delay but it can be arbitrarily small.
Typically, we want it to be very small. Delayed communication between
the defenders causes natural orphans even without attacker interference.
Natural orphans are a separate problem from Selfish Mining, thus we want
to avoid them. That&rsquo;s possible by setting $\varepsilon \ll
\lambda^{-1}$, that is, making the defender&rsquo;s message delay much smaller
than the (expected) block interval. A nice trick is to set $\lambda = 1$
which implies that the natural orphan rate is bounded by $\varepsilon$.
We typically use $\lambda = 1$ and $\varepsilon = 10^{-9}$.</p><p>The network size $n$ matters as well. In Selfish Mining, after <em>each</em>
block race <em>exactly</em> $\gamma$ of the defender hash-rate mines on the
attacker&rsquo;s block. In the constructed network, the number of defenders
mining on the attacker&rsquo;s block is random. The expected value is $\gamma$
by construction, but the variance depends on the number of defenders.
Higher $n$ implies more messages per block race and&mdash;by the law of large
numbers&mdash;less variance around $\gamma$.</p><h2 id=specification>Specification <a href=#specification class=anchor aria-hidden=true>#</a></h2><p>The last step is to produce some Python-like specification that works as
input for our <a href=/cpr/docs/methods/simulator/>network simulator</a>. As
promised above, it works with any protocol specification (supplied in
Python module <code>protocol</code>) and attack (supplied in <code>attacker</code>).</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>protocol</span>  <span class=c1># protocol specification</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>attacker</span>  <span class=c1># attacker node implementation</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>numpy</span> <span class=kn>import</span> <span class=n>random</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Parameters:</span>
</span></span><span class=line><span class=cl><span class=n>n</span> <span class=o>=</span> <span class=mi>42</span>  <span class=c1># network size</span>
</span></span><span class=line><span class=cl><span class=n>alpha</span> <span class=o>=</span> <span class=mi>1</span> <span class=o>/</span> <span class=mi>3</span>  <span class=c1># attacker&#39;s relative hash-rate</span>
</span></span><span class=line><span class=cl><span class=n>gamma</span> <span class=o>=</span> <span class=mf>0.5</span>  <span class=c1># Selfish Mining&#39;s Gamma</span>
</span></span><span class=line><span class=cl><span class=n>epsilon</span> <span class=o>=</span> <span class=mf>1e-9</span>  <span class=c1># propagation delay honest --&gt; honest</span>
</span></span><span class=line><span class=cl><span class=n>lambda_</span> <span class=o>=</span> <span class=mi>1</span> <span class=o>/</span> <span class=mi>600</span>  <span class=c1># network&#39;s mining rate</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Safety checks:</span>
</span></span><span class=line><span class=cl><span class=k>assert</span> <span class=mi>3</span> <span class=o>&lt;=</span> <span class=n>n</span>
</span></span><span class=line><span class=cl><span class=k>assert</span> <span class=mi>0</span> <span class=o>&lt;=</span> <span class=n>alpha</span> <span class=o>&lt;=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl><span class=k>assert</span> <span class=mi>0</span> <span class=o>&lt;=</span> <span class=n>gamma</span> <span class=o>&lt;=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl><span class=k>assert</span> <span class=mi>0</span> <span class=o>&lt;</span> <span class=n>epsilon</span>
</span></span><span class=line><span class=cl><span class=k>assert</span> <span class=mi>1</span> <span class=o>/</span> <span class=p>(</span><span class=mi>1</span> <span class=o>-</span> <span class=n>gamma</span><span class=p>)</span> <span class=o>+</span> <span class=mi>1</span> <span class=o>&lt;=</span> <span class=n>n</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>mining_delay</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>random</span><span class=o>.</span><span class=n>exponential</span><span class=p>(</span><span class=n>scale</span><span class=o>=</span><span class=mi>1</span> <span class=o>/</span> <span class=n>lambda_</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>select_miner</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=n>dhr</span> <span class=o>=</span> <span class=p>(</span><span class=mi>1</span> <span class=o>-</span> <span class=n>alpha</span><span class=p>)</span> <span class=o>/</span> <span class=p>(</span><span class=n>n</span> <span class=o>-</span> <span class=mi>1</span><span class=p>)</span>  <span class=c1># defender hash rate</span>
</span></span><span class=line><span class=cl>    <span class=n>hash_rates</span> <span class=o>=</span> <span class=p>[</span><span class=n>alpha</span><span class=p>]</span> <span class=o>+</span> <span class=p>[</span><span class=n>dhr</span><span class=p>]</span> <span class=o>*</span> <span class=p>(</span><span class=n>n</span> <span class=o>-</span> <span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>random</span><span class=o>.</span><span class=n>choice</span><span class=p>(</span><span class=nb>range</span><span class=p>(</span><span class=n>n</span><span class=p>),</span> <span class=n>p</span><span class=o>=</span><span class=n>hash_rates</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>neighbours</span><span class=p>(</span><span class=n>i</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>[</span><span class=n>x</span> <span class=k>for</span> <span class=n>x</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>n</span><span class=p>)</span> <span class=k>if</span> <span class=n>x</span> <span class=o>!=</span> <span class=n>i</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>message_delay</span><span class=p>(</span><span class=n>src</span><span class=p>,</span> <span class=n>dst</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>d</span> <span class=o>=</span> <span class=p>(</span><span class=n>n</span> <span class=o>-</span> <span class=mi>2</span><span class=p>)</span> <span class=o>/</span> <span class=p>(</span><span class=n>n</span> <span class=o>-</span> <span class=mi>1</span><span class=p>)</span> <span class=o>*</span> <span class=n>epsilon</span> <span class=o>/</span> <span class=n>gamma</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>src</span> <span class=o>==</span> <span class=mi>0</span><span class=p>:</span>  <span class=c1># attacker --&gt; defender</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>random</span><span class=o>.</span><span class=n>uniform</span><span class=p>(</span><span class=n>low</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span> <span class=n>high</span><span class=o>=</span><span class=n>d</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>elif</span> <span class=n>dst</span> <span class=o>==</span> <span class=mi>0</span><span class=p>:</span>  <span class=c1># defender --&gt; attacker</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span><span class=p>:</span>  <span class=c1># defender --&gt; defender</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>epsilon</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>roots</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>protocol</span><span class=o>.</span><span class=n>roots</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>validity</span><span class=p>(</span><span class=n>block</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>protocol</span><span class=o>.</span><span class=n>validity</span><span class=p>(</span><span class=n>block</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>node</span><span class=p>(</span><span class=n>i</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>i</span> <span class=o>==</span> <span class=mi>0</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=p>(</span><span class=n>attacker</span><span class=o>.</span><span class=n>init</span><span class=p>,</span> <span class=n>attacker</span><span class=o>.</span><span class=n>update</span><span class=p>,</span> <span class=n>attacker</span><span class=o>.</span><span class=n>mining</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=p>(</span><span class=n>protocol</span><span class=o>.</span><span class=n>init</span><span class=p>,</span> <span class=n>protocol</span><span class=o>.</span><span class=n>update</span><span class=p>,</span> <span class=n>protocol</span><span class=o>.</span><span class=n>mining</span><span class=p>)</span>
</span></span></code></pre></div><h2 id=literature>Literature <a href=#literature class=anchor aria-hidden=true>#</a></h2><ul><li>Ittay Eyal and Emin G. Sirer. Majority is not enough: Bitcoin mining
is vulnerable. FC &lsquo;14; CACM &lsquo;18.
<a href=https://arxiv.org/abs/1311.0243>[preprint]</a>
<a href=https://link.springer.com/chapter/10.1007/978-3-662-45472-5_28>[publisher]</a>
<a href=https://dl.acm.org/doi/abs/10.1145/3212998>[publisher]</a></li><li>Ayelet Sapirshtein, Yonathan Sompolinsky, and Aviv Zohar. Optimal
Selfish Mining strategies in Bitcoin. FC &lsquo;16.
<a href=https://arxiv.org/abs/1507.06183>[preprint]</a>
<a href=https://link.springer.com/chapter/10.1007/978-3-662-54970-4_30>[publisher]</a></li></ul><div class=mt-4><a class="btn btn-light" href=https://pkel.github.io/tags/related-work/ role=button>related work</a>
<a class="btn btn-light" href=https://pkel.github.io/tags/selfish-mining/ role=button>selfish mining</a>
<a class="btn btn-light" href=https://pkel.github.io/tags/assumptions/ role=button>assumptions</a></div></div></div></article></div></div><footer class="footer text-muted"><div class=container-xxl><div class=row><div class="col-lg-8 order-last order-lg-first"><ul class=list-inline><li class=list-inline-item>Powered by <a class=text-muted href=https://gohugo.io/>Hugo</a> and <a class=text-muted href=https://getdoks.org/>Doks</a></li></ul></div><div class="col-lg-8 order-first order-lg-last text-lg-end"><ul class=list-inline></ul></div></div></div></footer><script src=/cpr/js/bootstrap.min.87685cf4e6585276ff9e7b5d0b97e792615af6921e77821315d1ca7c5511ac2f30667e16c0d031e680ca8b57f63f6c0f6c4a232da777cce474b501ed81e090a9.js integrity="sha512-h2hc9OZYUnb/nntdC5fnkmFa9pIed4ITFdHKfFURrC8wZn4WwNAx5oDKi1f2P2wPbEojLad3zOR0tQHtgeCQqQ==" crossorigin=anonymous defer></script>
<script src=/cpr/js/highlight.min.56a414730f1135fe77b5ea30bf74a2cc4101a6f386e85e5b789c800570cc33d33054000f45932c053a59b41018f72687867254a80e1b9710671852492533162f.js integrity="sha512-VqQUcw8RNf53teowv3SizEEBpvOG6F5beJyABXDMM9MwVAAPRZMsBTpZtBAY9yaHhnJUqA4blxBnGFJJJTMWLw==" crossorigin=anonymous defer></script>
<script src=/cpr/js/vendor/katex/dist/katex.min.ed3f25b49c13f756d6454d3bfdc2090afae6101a06312e6bd27f154380b31c955bb4615215ef7518b270b4f9013bc757ffa2587509afd55cbf98bdd4e06064b3.js integrity="sha512-7T8ltJwT91bWRU07/cIJCvrmEBoGMS5r0n8VQ4CzHJVbtGFSFe91GLJwtPkBO8dX/6JYdQmv1Vy/mL3U4GBksw==" crossorigin=anonymous defer></script>
<script src=/cpr/js/vendor/katex/dist/contrib/auto-render.min.f128dc24877a8ff5cdc694570f6cd25f8ad512d4330c242487c4cbbc5dc6fd2c52de778da1e59f98585d1defd5aa5aa583da59e90e6837973ecca3b45b01fb64.js integrity="sha512-8SjcJId6j/XNxpRXD2zSX4rVEtQzDCQkh8TLvF3G/SxS3neNoeWfmFhdHe/Vqlqlg9pZ6Q5oN5c+zKO0WwH7ZA==" crossorigin=anonymous defer></script>
<script src=/cpr/main.min.dcd3405902a4381167a9b62eb3f84939ffa863717d14f9ad3d6ac60715885caacc14864978ab396dca37cd3c69d903d955c44c33896c13f3ff6f7609fb10215f.js integrity="sha512-3NNAWQKkOBFnqbYus/hJOf+oY3F9FPmtPWrGBxWIXKrMFIZJeKs5bco3zTxp2QPZVcRMM4lsE/P/b3YJ+xAhXw==" crossorigin=anonymous defer></script>
<script src=https://pkel.github.io/cpr/index.min.44246e6b95ff8e2a0c6416e0cb97b7de909ed337521a53913bc7edb59c2ad2bed32344fffa3de8b3c8de1a8bbba0e14f1a6a661c72ea7ff2549240038d762701.js integrity="sha512-RCRua5X/jioMZBbgy5e33pCe0zdSGlORO8fttZwq0r7TI0T/+j3os8jeGou7oOFPGmpmHHLqf/JUkkADjXYnAQ==" crossorigin=anonymous defer></script></body></html>