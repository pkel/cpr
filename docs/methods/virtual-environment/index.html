<!doctype html><html lang=en-us><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><link rel=preload as=font href=https://pkel.github.io/cpr/fonts/vendor/jost/jost-v4-latin-regular.woff2 type=font/woff2 crossorigin><link rel=preload as=font href=https://pkel.github.io/cpr/fonts/vendor/jost/jost-v4-latin-500.woff2 type=font/woff2 crossorigin><link rel=preload as=font href=https://pkel.github.io/cpr/fonts/vendor/jost/jost-v4-latin-700.woff2 type=font/woff2 crossorigin><link rel=preload as=font href=https://pkel.github.io/cpr/fonts/KaTeX_Main-Regular.woff2 type=font/woff2 crossorigin><link rel=preload as=font href=https://pkel.github.io/cpr/fonts/KaTeX_Math-Italic.woff2 type=font/woff2 crossorigin><link rel=stylesheet href=https://pkel.github.io/cpr/main.6e037184ad2fffb3cb08d2d2b77a9bc14a94a0b2928bf6322547eff1b32067172eb1864ac39b8b3387219794c38e8ed2072e7e76f957d321ccf5a606383583e5.css integrity="sha512-bgNxhK0v/7PLCNLSt3qbwUqUoLKSi/YyJUfv8bMgZxcusYZKw5uLM4chl5TDjo7SBy5+dvlX0yHM9aYGODWD5Q==" crossorigin=anonymous><noscript><style>img.lazyload{display:none}</style></noscript><meta name=robots content="index, follow"><meta name=googlebot content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1"><meta name=bingbot content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1"><title>Virtual Environment - CPR</title><meta name=description content="Execution model for proof-of-work protocols.
"><link rel=canonical href=https://pkel.github.io/cpr/docs/methods/virtual-environment/><meta property="og:locale" content><meta property="og:type" content="article"><meta property="og:title" content="Virtual Environment"><meta property="og:description" content="Execution model for proof-of-work protocols.
"><meta property="og:url" content="https://pkel.github.io/cpr/docs/methods/virtual-environment/"><meta property="og:site_name" content="CPR"><meta property="article:modified_time" content="2022-12-16T14:11:50+01:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:site content><meta name=twitter:creator content><meta name=twitter:title content="Virtual Environment"><meta name=twitter:description content="Execution model for proof-of-work protocols.
"><meta name=twitter:card content="summary"><meta name=twitter:image:alt content="Virtual Environment"><script type=application/ld+json>{"@context":"https://schema.org","@graph":[{"@type":"Person","@id":"https://pkel.github.io/#/schema/person/1","name":"CPR","url":"https://pkel.github.io/","sameAs":["https://github.com/pkel/cpr"],"image":{"@type":"ImageObject","@id":"https://pkel.github.io/#/schema/image/1","url":"https://pkel.github.io/\u003cnil\u003e","width":null,"height":null,"caption":"CPR"}},{"@type":"WebSite","@id":"https://pkel.github.io/#/schema/website/1","url":"https://pkel.github.io/","name":"CPR","description":"CPR provides tools for specifying, simulating, and attacking proof-of-work consensus protocols like Bitcoin and Ethereum.","publisher":{"@id":"https://pkel.github.io/#/schema/person/1"}},{"@type":"WebPage","@id":"https://pkel.github.io/cpr/docs/methods/virtual-environment/","url":"https://pkel.github.io/cpr/docs/methods/virtual-environment/","name":"Virtual Environment","description":"Execution model for proof-of-work protocols.\n","isPartOf":{"@id":"https://pkel.github.io/#/schema/website/1"},"about":{"@id":"https://pkel.github.io/#/schema/person/1"},"datePublished":"0001-01-01T00:00:00CET","dateModified":"2022-12-16T14:11:50CET","breadcrumb":{"@id":"https://pkel.github.io/cpr/docs/methods/virtual-environment/#/schema/breadcrumb/1"},"primaryImageOfPage":{"@id":"https://pkel.github.io/cpr/docs/methods/virtual-environment/#/schema/image/2"},"inLanguage":"en-US","potentialAction":[{"@type":"ReadAction","target":["https://pkel.github.io/cpr/docs/methods/virtual-environment/"]}]},{"@type":"BreadcrumbList","@id":"https://pkel.github.io/cpr/docs/methods/virtual-environment/#/schema/breadcrumb/1","name":"Breadcrumbs","itemListElement":[{"@type":"ListItem","position":1,"item":{"@type":"WebPage","@id":"https://pkel.github.io/cpr/","url":"https://pkel.github.io/cpr/","name":"Home"}},{"@type":"ListItem","position":2,"item":{"@type":"WebPage","@id":"https://pkel.github.io/cpr/docs/","url":"https://pkel.github.io/cpr/docs/","name":"Docs"}},{"@type":"ListItem","position":3,"item":{"@type":"WebPage","@id":"https://pkel.github.io/cpr/docs/methods/","url":"https://pkel.github.io/cpr/docs/methods/","name":"Methods"}},{"@type":"ListItem","position":4,"item":{"@id":"https://pkel.github.io/cpr/docs/methods/virtual-environment/"}}]},{"@context":"https://schema.org","@graph":[{"@type":"Article","@id":"https://pkel.github.io/#/schema/article/1","headline":"Virtual Environment","description":"Execution model for proof-of-work protocols.\n","isPartOf":{"@id":"https://pkel.github.io/cpr/docs/methods/virtual-environment/"},"mainEntityOfPage":{"@id":"https://pkel.github.io/cpr/docs/methods/virtual-environment/"},"datePublished":"0001-01-01T00:00:00CET","dateModified":"2022-12-16T14:11:50CET","author":{"@id":"https://pkel.github.io/#/schema/person/2"},"publisher":{"@id":"https://pkel.github.io/#/schema/person/1"},"image":{"@id":"https://pkel.github.io/cpr/docs/methods/virtual-environment/#/schema/image/2"}}]},{"@context":"https://schema.org","@graph":[{"@type":"Person","@id":"https://pkel.github.io/#/schema/person/2","name":"Patrik Keller","sameAs":["https://github.com/pkel"]}]},{"@context":"https://schema.org","@graph":[{"@type":"ImageObject","@id":"https://pkel.github.io/cpr/docs/methods/virtual-environment/#/schema/image/2","url":null,"contentUrl":null,"caption":"Virtual Environment"}]}]}</script><meta name=theme-color content="#fff"><link rel=icon href=https://pkel.github.io/cpr/favicon.ico sizes=any><link rel=apple-touch-icon sizes=180x180 href=https://pkel.github.io/cpr/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=https://pkel.github.io/cpr/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=https://pkel.github.io/cpr/favicon-16x16.png><link rel=manifest crossorigin=use-credentials href=https://pkel.github.io/cpr/site.webmanifest></head><body class="docs single"><div class=sticky-top><div class=header-bar></div><header class="navbar navbar-expand-lg navbar-light doks-navbar"><nav class="container-xxl flex-wrap flex-lg-nowrap" aria-label="Main navigation"><a class="navbar-brand order-0" href=/ aria-label=CPR>CPR</a>
<button class="btn btn-link order-0 ms-auto d-lg-none" type=button data-bs-toggle=offcanvas data-bs-target=#offcanvasExample aria-controls=offcanvasExample><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-more-horizontal"><circle cx="12" cy="12" r="1"/><circle cx="19" cy="12" r="1"/><circle cx="5" cy="12" r="1"/></svg></button><div class="offcanvas offcanvas-start d-lg-none" tabindex=-1 id=offcanvasExample aria-labelledby=offcanvasExampleLabel><div class=header-bar></div><div class=offcanvas-header><h5 class=offcanvas-title id=offcanvasExampleLabel>Browse docs</h5><button type=button class=btn-close data-bs-dismiss=offcanvas aria-label=Close></button></div><div class=offcanvas-body><aside class="doks-sidebar mt-n3"><nav id=doks-docs-nav aria-label="Tertiary navigation"><ul class="list-unstyled collapsible-sidebar"><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-5f2cae171c6192fa410df4385f7218aa aria-expanded=false>
Prologue</button><div class=collapse id=section-5f2cae171c6192fa410df4385f7218aa><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=https://pkel.github.io/cpr/docs/prologue/introduction/>Introduction</a></li><li><a class="docs-link rounded" href=https://pkel.github.io/cpr/docs/prologue/faq/>FAQ</a></li></ul></div></li><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-2ba0c1d2f0f117d4512ef6170fe0e015 aria-expanded=true>
Methodology</button><div class="collapse show" id=section-2ba0c1d2f0f117d4512ef6170fe0e015><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded active" href=https://pkel.github.io/cpr/docs/methods/virtual-environment/>Virtual Environment</a></li><li><a class="docs-link rounded" href=https://pkel.github.io/cpr/docs/methods/protocol-specification/>Protocol Specification</a></li><li><a class="docs-link rounded" href=https://pkel.github.io/cpr/docs/methods/simulator/>Simulator</a></li></ul></div></li><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-9985b4390c40137573e6da05caf85874 aria-expanded=false>
Protocols</button><div class=collapse id=section-9985b4390c40137573e6da05caf85874><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=https://pkel.github.io/cpr/docs/protocols/overview/>Overview</a></li><li><a class="docs-link rounded" href=https://pkel.github.io/cpr/docs/protocols/nakamoto/>Nakamoto</a></li><li><a class="docs-link rounded" href=https://pkel.github.io/cpr/docs/protocols/parallel-simple/>Parallel PoW (simplified)</a></li><li><a class="docs-link rounded" href=https://pkel.github.io/cpr/docs/protocols/parallel-aft22/>Parallel PoW (AFTâ€‰'22)</a></li><li><a class="docs-link rounded" href=https://pkel.github.io/cpr/docs/protocols/parallel-tree/>Tree-Structured Voting</a></li><li><a class="docs-link rounded" href=https://pkel.github.io/cpr/docs/protocols/tailstorm/>Tailstorm</a></li></ul></div></li></ul></nav></aside></div></div><button class="btn btn-menu order-2 d-block d-lg-none" type=button data-bs-toggle=offcanvas data-bs-target=#offcanvasDoks aria-controls=offcanvasDoks aria-label="Open main menu"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="18" x2="21" y2="18"/></svg></button><div class="offcanvas offcanvas-end border-0 py-lg-1" tabindex=-1 id=offcanvasDoks data-bs-backdrop=true aria-labelledby=offcanvasDoksLabel><div class="header-bar d-lg-none"></div><div class="offcanvas-header d-lg-none"><h2 class="h5 offcanvas-title ps-2" id=offcanvasDoksLabel><a class=text-dark href=/>CPR</a></h2><button type=button class="btn-close text-reset me-2" data-bs-dismiss=offcanvas aria-label="Close main menu"></button></div><div class="offcanvas-body p-4 p-lg-0"><ul class="nav flex-column flex-lg-row align-items-lg-center mt-2 mt-lg-0 ms-lg-2 me-lg-auto"><li class=nav-item><a class="nav-link ps-0 py-1 active" href=/cpr/docs/prologue/introduction/>Docs</a></li><li class=nav-item><a class="nav-link ps-0 py-1" href=/cpr/blog/>Blog</a></li></ul><hr class="text-black-50 my-4 d-lg-none"><form class="doks-search position-relative flex-grow-1 ms-lg-auto me-lg-2"><input id=search class="form-control is-search" type=search placeholder="Search docs..." aria-label="Search docs..." autocomplete=off><div id=suggestions class="shadow bg-white rounded d-none"></div></form><hr class="text-black-50 my-4 d-lg-none"><ul class="nav flex-column flex-lg-row"><li class=nav-item><a class="nav-link social-link" href=https://github.com/pkel/cpr><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-github"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77 5.44 5.44.0 003.5 8.55c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg><small class="ms-2 d-lg-none">GitHub</small></a></li></ul></div></div></nav></header></div><div class=container-xxl><aside class=doks-sidebar><nav id=doks-docs-nav class="collapse d-lg-none" aria-label="Tertiary navigation"><ul class="list-unstyled collapsible-sidebar"><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-5f2cae171c6192fa410df4385f7218aa aria-expanded=false>
Prologue</button><div class=collapse id=section-5f2cae171c6192fa410df4385f7218aa><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=https://pkel.github.io/cpr/docs/prologue/introduction/>Introduction</a></li><li><a class="docs-link rounded" href=https://pkel.github.io/cpr/docs/prologue/faq/>FAQ</a></li></ul></div></li><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-2ba0c1d2f0f117d4512ef6170fe0e015 aria-expanded=true>
Methodology</button><div class="collapse show" id=section-2ba0c1d2f0f117d4512ef6170fe0e015><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded active" href=https://pkel.github.io/cpr/docs/methods/virtual-environment/>Virtual Environment</a></li><li><a class="docs-link rounded" href=https://pkel.github.io/cpr/docs/methods/protocol-specification/>Protocol Specification</a></li><li><a class="docs-link rounded" href=https://pkel.github.io/cpr/docs/methods/simulator/>Simulator</a></li></ul></div></li><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-9985b4390c40137573e6da05caf85874 aria-expanded=false>
Protocols</button><div class=collapse id=section-9985b4390c40137573e6da05caf85874><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=https://pkel.github.io/cpr/docs/protocols/overview/>Overview</a></li><li><a class="docs-link rounded" href=https://pkel.github.io/cpr/docs/protocols/nakamoto/>Nakamoto</a></li><li><a class="docs-link rounded" href=https://pkel.github.io/cpr/docs/protocols/parallel-simple/>Parallel PoW (simplified)</a></li><li><a class="docs-link rounded" href=https://pkel.github.io/cpr/docs/protocols/parallel-aft22/>Parallel PoW (AFTâ€‰'22)</a></li><li><a class="docs-link rounded" href=https://pkel.github.io/cpr/docs/protocols/parallel-tree/>Tree-Structured Voting</a></li><li><a class="docs-link rounded" href=https://pkel.github.io/cpr/docs/protocols/tailstorm/>Tailstorm</a></li></ul></div></li></ul></nav></aside></div><div class="wrap container-xxl" role=document><div class=content><div class="row flex-xl-nowrap"><div class="col-lg-5 col-xl-4 docs-sidebar d-none d-lg-block"><nav class=docs-links aria-label="Main navigation"><ul class="list-unstyled collapsible-sidebar"><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-5f2cae171c6192fa410df4385f7218aa aria-expanded=false>
Prologue</button><div class=collapse id=section-5f2cae171c6192fa410df4385f7218aa><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=https://pkel.github.io/cpr/docs/prologue/introduction/>Introduction</a></li><li><a class="docs-link rounded" href=https://pkel.github.io/cpr/docs/prologue/faq/>FAQ</a></li></ul></div></li><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-2ba0c1d2f0f117d4512ef6170fe0e015 aria-expanded=true>
Methodology</button><div class="collapse show" id=section-2ba0c1d2f0f117d4512ef6170fe0e015><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded active" href=https://pkel.github.io/cpr/docs/methods/virtual-environment/>Virtual Environment</a></li><li><a class="docs-link rounded" href=https://pkel.github.io/cpr/docs/methods/protocol-specification/>Protocol Specification</a></li><li><a class="docs-link rounded" href=https://pkel.github.io/cpr/docs/methods/simulator/>Simulator</a></li></ul></div></li><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-9985b4390c40137573e6da05caf85874 aria-expanded=false>
Protocols</button><div class=collapse id=section-9985b4390c40137573e6da05caf85874><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=https://pkel.github.io/cpr/docs/protocols/overview/>Overview</a></li><li><a class="docs-link rounded" href=https://pkel.github.io/cpr/docs/protocols/nakamoto/>Nakamoto</a></li><li><a class="docs-link rounded" href=https://pkel.github.io/cpr/docs/protocols/parallel-simple/>Parallel PoW (simplified)</a></li><li><a class="docs-link rounded" href=https://pkel.github.io/cpr/docs/protocols/parallel-aft22/>Parallel PoW (AFTâ€‰'22)</a></li><li><a class="docs-link rounded" href=https://pkel.github.io/cpr/docs/protocols/parallel-tree/>Tree-Structured Voting</a></li><li><a class="docs-link rounded" href=https://pkel.github.io/cpr/docs/protocols/tailstorm/>Tailstorm</a></li></ul></div></li></ul></nav></div><nav class="docs-toc d-none d-xl-block col-xl-3" aria-label="Secondary navigation"><div class=d-xl-none><button class="btn btn-outline-primary btn-sm doks-toc-toggle collapsed" type=button data-bs-toggle=collapse data-bs-target=#onThisPage aria-controls=doks-docs-nav aria-expanded=false aria-label="Toggle On this page navigation">
<span>On this page</span>
<span><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" class="doks doks-expand" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><title>Expand</title><polyline points="7 13 12 18 17 13"/><polyline points="7 6 12 11 17 6"/></svg><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" class="doks doks-collapse" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><title>Collapse</title><polyline points="17 11 12 6 7 11"/><polyline points="17 18 12 13 7 18"/></svg></span></button><div class=collapse id=onThisPage><div class="card card-body mt-3 py-1"><div class=page-links><nav id=TableOfContents><ul><li><a href=#distributed-systems>Distributed Systems</a></li><li><a href=#blobs-hashes-blockchain>Blobs, Hashes, Blockchain</a></li><li><a href=#visibility-and-communication>Visibility and Communication</a></li><li><a href=#proof-of-work>Proof-of-Work</a></li></ul></nav></div></div></div></div><div class="page-links d-none d-xl-block"><h3>On this page</h3><nav id=TableOfContents><ul><li><a href=#distributed-systems>Distributed Systems</a></li><li><a href=#blobs-hashes-blockchain>Blobs, Hashes, Blockchain</a></li><li><a href=#visibility-and-communication>Visibility and Communication</a></li><li><a href=#proof-of-work>Proof-of-Work</a></li></ul></nav></div></nav><main class="docs-content col-lg-11 col-xl-9"><h1>Virtual Environment</h1><p class=lead>Execution model for proof-of-work protocols.</p><nav class=d-xl-none aria-label="Quaternary navigation"><div class=d-xl-none><button class="btn btn-outline-primary btn-sm doks-toc-toggle collapsed" type=button data-bs-toggle=collapse data-bs-target=#onThisPage aria-controls=doks-docs-nav aria-expanded=false aria-label="Toggle On this page navigation">
<span>On this page</span>
<span><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" class="doks doks-expand" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><title>Expand</title><polyline points="7 13 12 18 17 13"/><polyline points="7 6 12 11 17 6"/></svg><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" class="doks doks-collapse" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><title>Collapse</title><polyline points="17 11 12 6 7 11"/><polyline points="17 18 12 13 7 18"/></svg></span></button><div class=collapse id=onThisPage><div class="card card-body mt-3 py-1"><div class=page-links><nav id=TableOfContents><ul><li><a href=#distributed-systems>Distributed Systems</a></li><li><a href=#blobs-hashes-blockchain>Blobs, Hashes, Blockchain</a></li><li><a href=#visibility-and-communication>Visibility and Communication</a></li><li><a href=#proof-of-work>Proof-of-Work</a></li></ul></nav></div></div></div></div><div class="page-links d-none d-xl-block"><h3>On this page</h3><nav id=TableOfContents><ul><li><a href=#distributed-systems>Distributed Systems</a></li><li><a href=#blobs-hashes-blockchain>Blobs, Hashes, Blockchain</a></li><li><a href=#visibility-and-communication>Visibility and Communication</a></li><li><a href=#proof-of-work>Proof-of-Work</a></li></ul></nav></div></nav><p>CPR&rsquo;s core component is a network simulation engine for proof-of-work
protocols. The engine takes a protocol specification and a network
topology as input, then simulates the execution of the protocol in the
network over time. In this document we will focus on the theoretical
aspects of this virtual environment. We will describe what we simulate
and why but not how. In other words, we will define a model for virtual
protocol execution.</p><h2 id=distributed-systems>Distributed Systems <a href=#distributed-systems class=anchor aria-hidden=true>#</a></h2><p>From a technical perspective, proof-of-work blockchains are distributed
systems. The individual system participants are called nodes. Nodes
maintain local state and communicate with each other through messages
over an existing network. The protocol specifies how the nodes behave,
that is, how they update their state and what messages they send. It is
useful to think of each node as one physical machine.</p><p>On the conceptual layer we have to deal with the nodes&rsquo; operators. In
some settings&mdash;let&rsquo;s say for a distributed database deployed within a
corporation&mdash;it&rsquo;s sufficient to model a single operator who deploys all
nodes. In such a setting, one may assume that all nodes follow the
protocol specification. Sure, a node may stop being responsive due to
network congestion, hardware problems, or power outages, but it will not
arbitrarily deviate from the protocol. In distributed systems
literature, this is often called the fail-stop model or model of benign
failures.</p><p>For proof-of-work protocols the fail-stop model is not sufficient.
Anybody can add and remove nodes as they want. Consequently, we have to
assume that some nodes deviate from the protocol&mdash;usually in order to
maximize the operator&rsquo;s own benefits. Usually it&rsquo;s quite hard to pin
down what deviations are possible or make sense. In order to be on the
safe side, we have to consider arbitrary deviations. Highlighting the
difference to benign failures, arbitrary deviations are often called
Byzantine faults. The discipline around building protocols that work in
in the presence of Byzantine faults is called Byzantine Fault Tolerance
(BFT).</p><p>When we say a node is honest or benign, we mean that it follows the
protocol as specified. Nodes that deviate from the protocol are called
malicious nodes. Attackers are operators who deploy malicious nodes.
Defenders are operators who deploy honest nodes.</p><p>It is quite obvious that any distributed system stops working as
indented when there are too many malicious nodes. In the extreme case,
all nodes deviate from the protocol and there is nothing to defend. So,
distributed system security always starts with assumptions which limit the
attacker. In traditional distributed systems one would limit the number
of malicious nodes. In proof-of-work systems we limit the hash-rate of
the attacker.</p><div class="alert alert-doks d-flex" role=alert><div class="flex-shrink-1 alert-icon">ðŸ‘‰</div><div class=w-100>No security without assumptions!</div></div><p>When strategic deviations from the protocol are plausible, strategic
manipulation of the underlying network is plausible as well. Some
attackers might have sufficient resources to slow down or even prevent
communication between the defenders. Again, a super strong network-level
attacker can bring down any distributed system. In the most extreme case
the honest nodes cannot communicate at all and hence the distributed
system does not really exist.</p><p>Choosing the right assumptions is difficult. Make them too weak and no
useful property can be achieved. Make them too strong and they become
unrealistic. Smart attackers will violate our assumptions whenever
possible.</p><p>We postpone making concrete assumptions to the analysis phase of
individual protocols. At this point, we make only minimal assumptions
about the execution model. We assume there are nodes but not how many.
We assume that proof-of-work slows down all nodes, but we do not yet
limit the attacker&rsquo;s hash-rate. We assume that all nodes can send and
receive messages, but we do not yet limit the propagation delays.</p><h2 id=blobs-hashes-blockchain>Blobs, Hashes, Blockchain <a href=#blobs-hashes-blockchain class=anchor aria-hidden=true>#</a></h2><p>In practice, nodes are computers. They manipulate binary data locally
and send binary data over a network for communication. The central data
structure of proof-of-work protocols is the hash-linked list. Blobs of
data can refer to other blobs by including a hash of the referenced
blob. The hash-function is practically collision-free, which makes the
list effectively append-only. It&rsquo;s always possible to append a blob to
another, thereby extending (or forking) the list. But it is never
possible to edit referenced blobs. Any change to a blob changes its
hash. Any blob referring to the old version of the changed blob
still includes the old hash and thus refers to the unmodified blob.</p><p>In theory, we do not want to deal with binary data and thus introduce an
abstraction for blobs and hash-linking. We reuse the prevalent
terminology. Blobs are now blocks. Each block can have an arbitrary
number of parent blocks (including none), modelling what we called
hash-links above. If block $a$ is a parent of block $b$, then block $b$
is a child of block $a$. Blocks that can be reached with the parent
relationship from block $a$ are called ancestors of $a$. Blocks that can
be reached with the child relationship from block $a$ are called
descendants of $a$. Blocks can store arbitrary data in named fields.
Blocks, their parents, and their fields are persistent. That is,
changing a block creates a copy of the block. Freshly copied blocks do
not have any descendants.</p><p>Blocks and the parent relationship form a directed acyclic graph which
we call block DAG. Within the DAG, blocks without parents are
called roots. Blocks without children are called leaves.
Looking at the DAG from roots to children, a parent block clearly comes
before its children, but children of the same parents (siblings) have
the same rank. We say the DAG imposes a partial order on the blocks.</p><p>Each block also defines a blockchain, namely the block itself and all
its ancestors. Blockchains have exactly one leave, which we sometimes
refer to as tip of the chain.</p><figure style=width:100%><div class="mermaid text-center">%% Rendering this graph requires Javascript.
graph RL
b0[root]
b1[block] --> b0
b2[block] --> b1
b3[block] --> b1
b4[block] --> b2 & b3
b5[block] --> b1 & b4
b6[block] --> b5
b10[tip] --> b6
classDef orphan opacity:0.5,fill:gray
b7[leave]:::orphan --> b5
b8[block]:::orphan --> b0
b9[leave]:::orphan --> b8 & b3
linkStyle 9,10,11,12 opacity:0.5, stroke:gray</div><figcaption>Block DAG example. Boxes are blocks and arrows indicate the parent-child
relationship. Parents are placed left of their children, highlighting
the DAG&rsquo;s partial order. A single root is on the far left and we&rsquo;ve
marked a tip on the far right. Blocks outside the corresponding
blockchain are painted gray.</figcaption></figure><h2 id=visibility-and-communication>Visibility and Communication <a href=#visibility-and-communication class=anchor aria-hidden=true>#</a></h2><p>In practice, verifying hash-links requires full knowledge of the
referenced blob. Without knowing the blob, its hash cannot be computed.
Without knowing the hash, the blob cannot be referred to. It is
impossible to distinguish between a link that was intentionally
broken&mdash;let&rsquo;s say by replacing the hash with a random number&mdash;and a
link to an existing but locally unavailable blob.</p><p>For the virtual environment, we introduce the concept of local block
visibility. Each block can be either visible to a node or not. Blocks
that are locally visible to a node will stay locally visible to this
node forever. If a block is locally visible, then all its ancestors are
also locally visible. This restriction does not apply to block children
where we local visibility might be partial.</p><p>In other words, we assume that nodes have partial knowledge about the
block DAG. A node&rsquo;s knowledge grows over time as it learns about new
blocks in the order imposed by the DAG.</p><p>Nodes can create blocks. For this, all parents must be locally visible.
Freshly created blocks are invisible to all nodes but their creator.
Nodes can decide to share blocks. Depending on the communication
assumptions (made elsewhere), the virtual environment makes visible
shared blocks, including all their ancestors, to the other nodes.
Typically, blocks which have never been shared, and whose descendants
have not been shared, will not be visible to any nodes but its creator.
We say these blocks are withheld by their creator. Usually, honest nodes
do not withhold blocks but malicious nodes do.</p><p>We model the determinism of hash-linked lists by allowing nodes to
re-create blocks. If two nodes create two identical blocks&mdash;that is,
blocks with the same parents, the same fields, and the same field
contents&mdash;then only one block is created and both nodes obtain
visibility of the same block.</p><h2 id=proof-of-work>Proof-of-Work <a href=#proof-of-work class=anchor aria-hidden=true>#</a></h2><p>In practice, proof-of-work is about finding blobs that have a small
hash. Typically, the protocol sets a difficulty target or number of
leading zeros the hash must have. Good hash-functions ensure that
finding such blobs is computationally expensive. The only viable solving
algorithm is repeated trial and error: modify the blob, calculate the
hash, count the leading zeroes, repeat while the difficulty target is
not met.</p><p>We avoid these expensive computations in our virtual environment.
Instead, each block gets an additional property, whether it has a
proof-of-work or not, which can be set only by the environment, not by
the nodes themselves. Blocks with a proof-of-work are unique, that means
they cannot be re-created by appending a block with the same parents and
fields.</p><p>Then, the virtual environment chooses which nodes succeed when at
proof-of-work. Whenever a node succeeds, the environment obtains from
the node a block proposal (parents, fields, and field contents), creates
the corresponding block, sets the proof-of-work property to true, and
then makes visible the new block to the selected node. We now refer to
the selected node as the miner of the new block.</p><p>Exact assumptions about the timing and selection of nodes are made
elsewhere. Typically, the time between consecutive mining events is
exponentially distributed with rate $\lambda$. The expected puzzle
solving time is $\lambda^{-1}$. Nodes are selected at random with
weighted probabilities. While $\lambda$ models the overall hash-rate in
the network, the weights model the distribution of hash-rate among the
participants. The attacker&rsquo;s hash-rate, that is, the sum of the
malicious nodes&rsquo; weights, is at most $\alpha$.</p><div class="page-footer-meta d-flex flex-column flex-md-row justify-content-between"><div class=last-modified><a href=https://github.com/pkel/cpr/commit/8e958a526ac5bf22fff13de94327abb22102e653><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>Last modified on December 16, 2022</a></div><div class=edit-page><a href=https://github.com/pkel/cpr/blob/website/website/content/en/docs/methods/virtual-environment.md><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-edit-2"><path d="M17 3a2.828 2.828.0 114 4L7.5 20.5 2 22l1.5-5.5L17 3z"/></svg>Edit this page on GitHub</a></div></div><div class="docs-navigation d-flex justify-content-between"><a href=/cpr/docs/prologue/faq/><div class="card my-1"><div class="card-body py-2">&larr; FAQ</div></div></a><a class=ms-auto href=/cpr/docs/methods/protocol-specification/><div class="card my-1"><div class="card-body py-2">Protocol Specification &rarr;</div></div></a></div></main></div></div></div><footer class="footer text-muted"><div class=container-xxl><div class=row><div class="col-lg-8 order-last order-lg-first"><ul class=list-inline><li class=list-inline-item>Powered by <a class=text-muted href=https://gohugo.io/>Hugo</a> and <a class=text-muted href=https://getdoks.org/>Doks</a></li></ul></div><div class="col-lg-8 order-first order-lg-last text-lg-end"><ul class=list-inline></ul></div></div></div></footer><script src=/cpr/js/bootstrap.min.87685cf4e6585276ff9e7b5d0b97e792615af6921e77821315d1ca7c5511ac2f30667e16c0d031e680ca8b57f63f6c0f6c4a232da777cce474b501ed81e090a9.js integrity="sha512-h2hc9OZYUnb/nntdC5fnkmFa9pIed4ITFdHKfFURrC8wZn4WwNAx5oDKi1f2P2wPbEojLad3zOR0tQHtgeCQqQ==" crossorigin=anonymous defer></script>
<script src=/cpr/js/highlight.min.56a414730f1135fe77b5ea30bf74a2cc4101a6f386e85e5b789c800570cc33d33054000f45932c053a59b41018f72687867254a80e1b9710671852492533162f.js integrity="sha512-VqQUcw8RNf53teowv3SizEEBpvOG6F5beJyABXDMM9MwVAAPRZMsBTpZtBAY9yaHhnJUqA4blxBnGFJJJTMWLw==" crossorigin=anonymous defer></script>
<script src=/cpr/js/vendor/katex/dist/katex.min.ed3f25b49c13f756d6454d3bfdc2090afae6101a06312e6bd27f154380b31c955bb4615215ef7518b270b4f9013bc757ffa2587509afd55cbf98bdd4e06064b3.js integrity="sha512-7T8ltJwT91bWRU07/cIJCvrmEBoGMS5r0n8VQ4CzHJVbtGFSFe91GLJwtPkBO8dX/6JYdQmv1Vy/mL3U4GBksw==" crossorigin=anonymous defer></script>
<script src=/cpr/js/vendor/katex/dist/contrib/auto-render.min.f128dc24877a8ff5cdc694570f6cd25f8ad512d4330c242487c4cbbc5dc6fd2c52de778da1e59f98585d1defd5aa5aa583da59e90e6837973ecca3b45b01fb64.js integrity="sha512-8SjcJId6j/XNxpRXD2zSX4rVEtQzDCQkh8TLvF3G/SxS3neNoeWfmFhdHe/Vqlqlg9pZ6Q5oN5c+zKO0WwH7ZA==" crossorigin=anonymous defer></script>
<script src=/cpr/main.min.dcd3405902a4381167a9b62eb3f84939ffa863717d14f9ad3d6ac60715885caacc14864978ab396dca37cd3c69d903d955c44c33896c13f3ff6f7609fb10215f.js integrity="sha512-3NNAWQKkOBFnqbYus/hJOf+oY3F9FPmtPWrGBxWIXKrMFIZJeKs5bco3zTxp2QPZVcRMM4lsE/P/b3YJ+xAhXw==" crossorigin=anonymous defer></script>
<script src=/cpr/js/mermaid.min.402b3ef4a812bab1460b2623191b7e1bed58adf94f9104432f2f8dea131061b21af41987b017cec9bbd0ceab64a0335904a40b8d639af05e754bc978247ef225.js integrity="sha512-QCs+9KgSurFGCyYjGRt+G+1YrflPkQRDLy+N6hMQYbIa9BmHsBfOybvQzqtkoDNZBKQLjWOa8F51S8l4JH7yJQ==" crossorigin=anonymous defer></script>
<script src=https://pkel.github.io/cpr/index.min.4b1fa0094c04766a2f88d2a4e5a41627ab01ca5f95d6a4e648afc83726a5bb314d10b91ec6e0a16aa2529cc9efd2345196bf922c25bbef95e06d97899d0e92e3.js integrity="sha512-Sx+gCUwEdmoviNKk5aQWJ6sByl+V1qTmSK/INyaluzFNELkexuChaqJSnMnv0jRRlr+SLCW775XgbZeJnQ6S4w==" crossorigin=anonymous defer></script></body></html>