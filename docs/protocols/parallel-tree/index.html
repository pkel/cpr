<!doctype html><html lang=en-us><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><link rel=preload as=font href=https://pkel.github.io/cpr/fonts/vendor/jost/jost-v4-latin-regular.woff2 type=font/woff2 crossorigin><link rel=preload as=font href=https://pkel.github.io/cpr/fonts/vendor/jost/jost-v4-latin-500.woff2 type=font/woff2 crossorigin><link rel=preload as=font href=https://pkel.github.io/cpr/fonts/vendor/jost/jost-v4-latin-700.woff2 type=font/woff2 crossorigin><link rel=preload as=font href=https://pkel.github.io/cpr/fonts/KaTeX_Main-Regular.woff2 type=font/woff2 crossorigin><link rel=preload as=font href=https://pkel.github.io/cpr/fonts/KaTeX_Math-Italic.woff2 type=font/woff2 crossorigin><script>(()=>{var t=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches,e=localStorage.getItem("theme");t&&e===null&&(localStorage.setItem("theme","dark"),document.documentElement.setAttribute("data-dark-mode","")),t&&e==="dark"&&document.documentElement.setAttribute("data-dark-mode",""),e==="dark"&&document.documentElement.setAttribute("data-dark-mode","")})()</script><link rel=stylesheet href=https://pkel.github.io/cpr/main.a4beb00ad3990d1069e7efea6f115698d36da10bd62578412975b6817dcf9d54309bebe7ddc9b53db1662394fbde1335c54efe98da7c3d758f19e12e619e2283.css integrity="sha512-pL6wCtOZDRBp5+/qbxFWmNNtoQvWJXhBKXW2gX3PnVQwm+vn3cm1PbFmI5T73hM1xU7+mNp8PXWPGeEuYZ4igw==" crossorigin=anonymous><noscript><style>img.lazyload{display:none}</style></noscript><meta name=robots content="index, follow"><meta name=googlebot content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1"><meta name=bingbot content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1"><title>Tree-Structured Voting - CPR</title><meta name=description content="Simple parallel proof-of-work with tree-structured voting.
"><link rel=canonical href=https://pkel.github.io/cpr/docs/protocols/parallel-tree/><meta property="og:locale" content><meta property="og:type" content="article"><meta property="og:title" content="Tree-Structured Voting"><meta property="og:description" content="Simple parallel proof-of-work with tree-structured voting.
"><meta property="og:url" content="https://pkel.github.io/cpr/docs/protocols/parallel-tree/"><meta property="og:site_name" content="CPR"><meta property="article:modified_time" content="2022-12-12T11:39:56+01:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:site content><meta name=twitter:creator content><meta name=twitter:title content="Tree-Structured Voting"><meta name=twitter:description content="Simple parallel proof-of-work with tree-structured voting.
"><meta name=twitter:card content="summary"><meta name=twitter:image:alt content="Tree-Structured Voting"><script type=application/ld+json>{"@context":"https://schema.org","@graph":[{"@type":"Person","@id":"https://pkel.github.io/#/schema/person/1","name":"CPR","url":"https://pkel.github.io/","sameAs":["https://github.com/pkel/cpr"],"image":{"@type":"ImageObject","@id":"https://pkel.github.io/#/schema/image/1","url":"https://pkel.github.io/\u003cnil\u003e","width":null,"height":null,"caption":"CPR"}},{"@type":"WebSite","@id":"https://pkel.github.io/#/schema/website/1","url":"https://pkel.github.io/","name":"CPR","description":"CPR provides tools for specifying, simulating, and attacking proof-of-work consensus protocols like Bitcoin and Ethereum.","publisher":{"@id":"https://pkel.github.io/#/schema/person/1"}},{"@type":"WebPage","@id":"https://pkel.github.io/cpr/docs/protocols/parallel-tree/","url":"https://pkel.github.io/cpr/docs/protocols/parallel-tree/","name":"Tree-Structured Voting","description":"Simple parallel proof-of-work with tree-structured voting.\n","isPartOf":{"@id":"https://pkel.github.io/#/schema/website/1"},"about":{"@id":"https://pkel.github.io/#/schema/person/1"},"datePublished":"0001-01-01T00:00:00CET","dateModified":"2022-12-12T11:39:56CET","breadcrumb":{"@id":"https://pkel.github.io/cpr/docs/protocols/parallel-tree/#/schema/breadcrumb/1"},"primaryImageOfPage":{"@id":"https://pkel.github.io/cpr/docs/protocols/parallel-tree/#/schema/image/2"},"inLanguage":"en-US","potentialAction":[{"@type":"ReadAction","target":["https://pkel.github.io/cpr/docs/protocols/parallel-tree/"]}]},{"@type":"BreadcrumbList","@id":"https://pkel.github.io/cpr/docs/protocols/parallel-tree/#/schema/breadcrumb/1","name":"Breadcrumbs","itemListElement":[{"@type":"ListItem","position":1,"item":{"@type":"WebPage","@id":"https://pkel.github.io/cpr/","url":"https://pkel.github.io/cpr/","name":"Home"}},{"@type":"ListItem","position":2,"item":{"@type":"WebPage","@id":"https://pkel.github.io/cpr/docs/","url":"https://pkel.github.io/cpr/docs/","name":"Docs"}},{"@type":"ListItem","position":3,"item":{"@type":"WebPage","@id":"https://pkel.github.io/cpr/docs/protocols/","url":"https://pkel.github.io/cpr/docs/protocols/","name":"Protocols"}},{"@type":"ListItem","position":4,"item":{"@id":"https://pkel.github.io/cpr/docs/protocols/parallel-tree/"}}]},{"@context":"https://schema.org","@graph":[{"@type":"Article","@id":"https://pkel.github.io/#/schema/article/1","headline":"Tree-Structured Voting","description":"Simple parallel proof-of-work with tree-structured voting.\n","isPartOf":{"@id":"https://pkel.github.io/cpr/docs/protocols/parallel-tree/"},"mainEntityOfPage":{"@id":"https://pkel.github.io/cpr/docs/protocols/parallel-tree/"},"datePublished":"0001-01-01T00:00:00CET","dateModified":"2022-12-12T11:39:56CET","author":{"@id":"https://pkel.github.io/#/schema/person/2"},"publisher":{"@id":"https://pkel.github.io/#/schema/person/1"},"image":{"@id":"https://pkel.github.io/cpr/docs/protocols/parallel-tree/#/schema/image/2"}}]},{"@context":"https://schema.org","@graph":[{"@type":"Person","@id":"https://pkel.github.io/#/schema/person/2","name":"Patrik Keller","sameAs":["https://github.com/pkel"]}]},{"@context":"https://schema.org","@graph":[{"@type":"ImageObject","@id":"https://pkel.github.io/cpr/docs/protocols/parallel-tree/#/schema/image/2","url":null,"contentUrl":null,"caption":"Tree-Structured Voting"}]}]}</script><meta name=theme-color content="#fff"><link rel=icon href=https://pkel.github.io/cpr/favicon.ico sizes=any><link rel=apple-touch-icon sizes=180x180 href=https://pkel.github.io/cpr/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=https://pkel.github.io/cpr/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=https://pkel.github.io/cpr/favicon-16x16.png><link rel=manifest crossorigin=use-credentials href=https://pkel.github.io/cpr/site.webmanifest></head><body class="docs single"><div class="alert alert-primary text-lg-center" role=alert>Preview deployment. Do not share links!</div><div class=sticky-top><div class=header-bar></div><header class="navbar navbar-expand-lg navbar-light doks-navbar"><nav class="container-xxl flex-wrap flex-lg-nowrap" aria-label="Main navigation"><a class="navbar-brand order-0" href=/ aria-label=CPR>CPR</a>
<button class="btn btn-link order-0 ms-auto d-lg-none" type=button data-bs-toggle=offcanvas data-bs-target=#offcanvasExample aria-controls=offcanvasExample><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-more-horizontal"><circle cx="12" cy="12" r="1"/><circle cx="19" cy="12" r="1"/><circle cx="5" cy="12" r="1"/></svg></button><div class="offcanvas offcanvas-start d-lg-none" tabindex=-1 id=offcanvasExample aria-labelledby=offcanvasExampleLabel><div class=header-bar></div><div class=offcanvas-header><h5 class=offcanvas-title id=offcanvasExampleLabel>Browse docs</h5><button type=button class=btn-close data-bs-dismiss=offcanvas aria-label=Close></button></div><div class=offcanvas-body><aside class="doks-sidebar mt-n3"><nav id=doks-docs-nav aria-label="Tertiary navigation"><ul class="list-unstyled collapsible-sidebar"><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-5f2cae171c6192fa410df4385f7218aa aria-expanded=false>
Prologue</button><div class=collapse id=section-5f2cae171c6192fa410df4385f7218aa><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=https://pkel.github.io/cpr/docs/prologue/introduction/>Introduction</a></li><li><a class="docs-link rounded" href=https://pkel.github.io/cpr/docs/prologue/faq/>FAQ</a></li></ul></div></li><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-2ba0c1d2f0f117d4512ef6170fe0e015 aria-expanded=false>
Methodology</button><div class=collapse id=section-2ba0c1d2f0f117d4512ef6170fe0e015><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=https://pkel.github.io/cpr/docs/methods/virtual-environment/>Virtual Environment</a></li><li><a class="docs-link rounded" href=https://pkel.github.io/cpr/docs/methods/protocol-specification/>Protocol Specification</a></li></ul></div></li><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-9985b4390c40137573e6da05caf85874 aria-expanded=true>
Protocols</button><div class="collapse show" id=section-9985b4390c40137573e6da05caf85874><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=https://pkel.github.io/cpr/docs/protocols/overview/>Overview</a></li><li><a class="docs-link rounded" href=https://pkel.github.io/cpr/docs/protocols/nakamoto/>Nakamoto</a></li><li><a class="docs-link rounded" href=https://pkel.github.io/cpr/docs/protocols/parallel-simple/>Parallel PoW (simplified)</a></li><li><a class="docs-link rounded" href=https://pkel.github.io/cpr/docs/protocols/parallel-aft22/>Parallel PoW (AFT '22)</a></li><li><a class="docs-link rounded active" href=https://pkel.github.io/cpr/docs/protocols/parallel-tree/>Tree-Structured Voting</a></li><li><a class="docs-link rounded" href=https://pkel.github.io/cpr/docs/protocols/tailstorm/>Tailstorm</a></li></ul></div></li></ul></nav></aside></div></div><button class="btn btn-menu order-2 d-block d-lg-none" type=button data-bs-toggle=offcanvas data-bs-target=#offcanvasDoks aria-controls=offcanvasDoks aria-label="Open main menu"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="18" x2="21" y2="18"/></svg></button><div class="offcanvas offcanvas-end border-0 py-lg-1" tabindex=-1 id=offcanvasDoks data-bs-backdrop=true aria-labelledby=offcanvasDoksLabel><div class="header-bar d-lg-none"></div><div class="offcanvas-header d-lg-none"><h2 class="h5 offcanvas-title ps-2" id=offcanvasDoksLabel><a class=text-dark href=/>CPR</a></h2><button type=button class="btn-close text-reset me-2" data-bs-dismiss=offcanvas aria-label="Close main menu"></button></div><div class="offcanvas-body p-4 p-lg-0"><ul class="nav flex-column flex-lg-row align-items-lg-center mt-2 mt-lg-0 ms-lg-2 me-lg-auto"><li class=nav-item><a class="nav-link ps-0 py-1 active" href=/cpr/docs/prologue/introduction/>Docs</a></li><li class=nav-item><a class="nav-link ps-0 py-1" href=/cpr/blog/>Blog</a></li></ul><hr class="text-black-50 my-4 d-lg-none"><form class="doks-search position-relative flex-grow-1 ms-lg-auto me-lg-2"><input id=search class="form-control is-search" type=search placeholder="Search docs..." aria-label="Search docs..." autocomplete=off><div id=suggestions class="shadow bg-white rounded d-none"></div></form><hr class="text-black-50 my-4 d-lg-none"><ul class="nav flex-column flex-lg-row"><li class=nav-item><a class="nav-link social-link" href=https://github.com/pkel/cpr><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-github"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77 5.44 5.44.0 003.5 8.55c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg><small class="ms-2 d-lg-none">GitHub</small></a></li></ul><hr class="text-black-50 my-4 d-lg-none"><button id=mode class="btn btn-link" type=button aria-label="Toggle user interface mode">
<span class=toggle-dark><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-moon"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg></span><span class=toggle-light><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-sun"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></span></button></div></div></nav></header></div><div class=container-xxl><aside class=doks-sidebar><nav id=doks-docs-nav class="collapse d-lg-none" aria-label="Tertiary navigation"><ul class="list-unstyled collapsible-sidebar"><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-5f2cae171c6192fa410df4385f7218aa aria-expanded=false>
Prologue</button><div class=collapse id=section-5f2cae171c6192fa410df4385f7218aa><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=https://pkel.github.io/cpr/docs/prologue/introduction/>Introduction</a></li><li><a class="docs-link rounded" href=https://pkel.github.io/cpr/docs/prologue/faq/>FAQ</a></li></ul></div></li><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-2ba0c1d2f0f117d4512ef6170fe0e015 aria-expanded=false>
Methodology</button><div class=collapse id=section-2ba0c1d2f0f117d4512ef6170fe0e015><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=https://pkel.github.io/cpr/docs/methods/virtual-environment/>Virtual Environment</a></li><li><a class="docs-link rounded" href=https://pkel.github.io/cpr/docs/methods/protocol-specification/>Protocol Specification</a></li></ul></div></li><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-9985b4390c40137573e6da05caf85874 aria-expanded=true>
Protocols</button><div class="collapse show" id=section-9985b4390c40137573e6da05caf85874><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=https://pkel.github.io/cpr/docs/protocols/overview/>Overview</a></li><li><a class="docs-link rounded" href=https://pkel.github.io/cpr/docs/protocols/nakamoto/>Nakamoto</a></li><li><a class="docs-link rounded" href=https://pkel.github.io/cpr/docs/protocols/parallel-simple/>Parallel PoW (simplified)</a></li><li><a class="docs-link rounded" href=https://pkel.github.io/cpr/docs/protocols/parallel-aft22/>Parallel PoW (AFT '22)</a></li><li><a class="docs-link rounded active" href=https://pkel.github.io/cpr/docs/protocols/parallel-tree/>Tree-Structured Voting</a></li><li><a class="docs-link rounded" href=https://pkel.github.io/cpr/docs/protocols/tailstorm/>Tailstorm</a></li></ul></div></li></ul></nav></aside></div><div class="wrap container-xxl" role=document><div class=content><div class="row flex-xl-nowrap"><div class="col-lg-5 col-xl-4 docs-sidebar d-none d-lg-block"><nav class=docs-links aria-label="Main navigation"><ul class="list-unstyled collapsible-sidebar"><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-5f2cae171c6192fa410df4385f7218aa aria-expanded=false>
Prologue</button><div class=collapse id=section-5f2cae171c6192fa410df4385f7218aa><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=https://pkel.github.io/cpr/docs/prologue/introduction/>Introduction</a></li><li><a class="docs-link rounded" href=https://pkel.github.io/cpr/docs/prologue/faq/>FAQ</a></li></ul></div></li><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-2ba0c1d2f0f117d4512ef6170fe0e015 aria-expanded=false>
Methodology</button><div class=collapse id=section-2ba0c1d2f0f117d4512ef6170fe0e015><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=https://pkel.github.io/cpr/docs/methods/virtual-environment/>Virtual Environment</a></li><li><a class="docs-link rounded" href=https://pkel.github.io/cpr/docs/methods/protocol-specification/>Protocol Specification</a></li></ul></div></li><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-9985b4390c40137573e6da05caf85874 aria-expanded=true>
Protocols</button><div class="collapse show" id=section-9985b4390c40137573e6da05caf85874><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=https://pkel.github.io/cpr/docs/protocols/overview/>Overview</a></li><li><a class="docs-link rounded" href=https://pkel.github.io/cpr/docs/protocols/nakamoto/>Nakamoto</a></li><li><a class="docs-link rounded" href=https://pkel.github.io/cpr/docs/protocols/parallel-simple/>Parallel PoW (simplified)</a></li><li><a class="docs-link rounded" href=https://pkel.github.io/cpr/docs/protocols/parallel-aft22/>Parallel PoW (AFT '22)</a></li><li><a class="docs-link rounded active" href=https://pkel.github.io/cpr/docs/protocols/parallel-tree/>Tree-Structured Voting</a></li><li><a class="docs-link rounded" href=https://pkel.github.io/cpr/docs/protocols/tailstorm/>Tailstorm</a></li></ul></div></li></ul></nav></div><nav class="docs-toc d-none d-xl-block col-xl-3" aria-label="Secondary navigation"><div class=d-xl-none><button class="btn btn-outline-primary btn-sm doks-toc-toggle collapsed" type=button data-bs-toggle=collapse data-bs-target=#onThisPage aria-controls=doks-docs-nav aria-expanded=false aria-label="Toggle On this page navigation">
<span>On this page</span>
<span><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" class="doks doks-expand" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><title>Expand</title><polyline points="7 13 12 18 17 13"/><polyline points="7 6 12 11 17 6"/></svg><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" class="doks doks-collapse" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><title>Collapse</title><polyline points="17 11 12 6 7 11"/><polyline points="17 18 12 13 7 18"/></svg></span></button><div class=collapse id=onThisPage><div class="card card-body mt-3 py-1"><div class=page-links><nav id=TableOfContents><ul><li><a href=#intuition>Intuition</a></li><li><a href=#example>Example</a></li><li><a href=#specification>Specification</a><ul><li><a href=#parameters>Parameters</a></li><li><a href=#blockchain>Blockchain</a></li><li><a href=#node>Node</a></li><li><a href=#difficulty-adjustment>Difficulty Adjustment</a></li><li><a href=#rewards>Rewards</a></li></ul></li><li><a href=#literature>Literature</a></li></ul></nav></div></div></div></div><div class="page-links d-none d-xl-block"><h3>On this page</h3><nav id=TableOfContents><ul><li><a href=#intuition>Intuition</a></li><li><a href=#example>Example</a></li><li><a href=#specification>Specification</a><ul><li><a href=#parameters>Parameters</a></li><li><a href=#blockchain>Blockchain</a></li><li><a href=#node>Node</a></li><li><a href=#difficulty-adjustment>Difficulty Adjustment</a></li><li><a href=#rewards>Rewards</a></li></ul></li><li><a href=#literature>Literature</a></li></ul></nav></div></nav><main class="docs-content col-lg-11 col-xl-9"><h1>Tree-Structured Voting</h1><p class=lead>Simple parallel proof-of-work with tree-structured voting.</p><nav class=d-xl-none aria-label="Quaternary navigation"><div class=d-xl-none><button class="btn btn-outline-primary btn-sm doks-toc-toggle collapsed" type=button data-bs-toggle=collapse data-bs-target=#onThisPage aria-controls=doks-docs-nav aria-expanded=false aria-label="Toggle On this page navigation">
<span>On this page</span>
<span><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" class="doks doks-expand" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><title>Expand</title><polyline points="7 13 12 18 17 13"/><polyline points="7 6 12 11 17 6"/></svg><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" class="doks doks-collapse" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><title>Collapse</title><polyline points="17 11 12 6 7 11"/><polyline points="17 18 12 13 7 18"/></svg></span></button><div class=collapse id=onThisPage><div class="card card-body mt-3 py-1"><div class=page-links><nav id=TableOfContents><ul><li><a href=#intuition>Intuition</a></li><li><a href=#example>Example</a></li><li><a href=#specification>Specification</a><ul><li><a href=#parameters>Parameters</a></li><li><a href=#blockchain>Blockchain</a></li><li><a href=#node>Node</a></li><li><a href=#difficulty-adjustment>Difficulty Adjustment</a></li><li><a href=#rewards>Rewards</a></li></ul></li><li><a href=#literature>Literature</a></li></ul></nav></div></div></div></div><div class="page-links d-none d-xl-block"><h3>On this page</h3><nav id=TableOfContents><ul><li><a href=#intuition>Intuition</a></li><li><a href=#example>Example</a></li><li><a href=#specification>Specification</a><ul><li><a href=#parameters>Parameters</a></li><li><a href=#blockchain>Blockchain</a></li><li><a href=#node>Node</a></li><li><a href=#difficulty-adjustment>Difficulty Adjustment</a></li><li><a href=#rewards>Rewards</a></li></ul></li><li><a href=#literature>Literature</a></li></ul></nav></div></nav><h2 id=intuition>Intuition <a href=#intuition class=anchor aria-hidden=true>#</a></h2><p>This protocol extends the <a href=../parallel-simple>simplified version</a> of
parallel proof-of-work with tree-structured voting. We allow votes to
link back to other votes, where previously they could only link back to
blocks. This tree structure enables a new incentive scheme where
non-linearities are punished fairly.</p><p>The new protocol maintains parallel proof-of-work&rsquo;s core property: votes
which confirm the same parent block are compatible and can be used
together to build the next block. To be clear, tree-structured voting
does not change the parallel voting mechanism of the other two parallel
protocols, <a href=../parallel-simple>simple</a> and <a href=../parallel-aft22>AFT &lsquo;22</a>
version.</p><p>In the new protocol, miners do not merely vote for the last block, but
they vote for the longest chain of votes. Optimally, all votes form a
linear chain and we know the exact order in they were mined. Otherwise,
the votes form a tree and the ordering of votes is partial.</p><p>Recall that ordering is the main objective of proof-of-work consensus
protocols. Tree-structured voting motivates forming a linear chain of
votes through incentives. The rewards for the votes in a block are scaled
down in proportion to the depth of the vote tree. Non-linearity implies
reduced reward.</p><p>Let&rsquo;s take a step back and recall <a href=../nakamoto>Nakamoto</a>&rsquo;s original
proof-of-work protocol. Also Nakamoto motivates linearity through
incentives. Blocks that to not end up on the linear blockchain are
orphaned and do not get rewards. In the intuition to the <a href=../parallel-simple>simple
parallel protocol</a> we&rsquo;ve seen that orphans are a
threat to security. But orphans also cause unfairness with respect to
honest behaviour. Imagine a situation where two miners&mdash;one weak (let&rsquo;s
say 2% of the hash-rate) and one strong (20% of the hash-rate)&mdash;mine
blocks around the same time and create a fork. Obviously, the weak miner
tries to confirm her block, the strong miner tries to confirm the other.
We do not know what the other miners (72% of the hash-rate) do. If we
assume that they are unbiased, that is, they mine one or the other block
with equal probability, we end up in a situation were 38% of the hash
rate tries to confirm the weak miners block and 62% of the hash rate
tries to confirm the strong miners block. Only one of the blocks will
end up in the final blockchain. The other does not get rewards. The
punishment mechanism for non-linearity is biased in favour of the strong
miner.</p><p>Tree-structured voting addresses this problem. Here, the reward is
discounted on a per-block basis. Non-linearity implies lower rewards but
the discount applies to all confirmed votes equally. The punishment bias
is removed, at least among the confirmed votes.</p><p>Tree-structured voting and the discounting of rewards were originally
proposed for the <a href=../tailstorm>Tailstorm</a> protocol. However, since
Tailstorm also does elaborate optimizations, we think it is easier to
first study this protocol.</p><h2 id=example>Example <a href=#example class=anchor aria-hidden=true>#</a></h2><figure style=width:100%><div class=mermaid>%% Rendering this graph requires Javascript.
graph RL
b0[h]
b1[h+1] --> v3([3]) --> v2([2]) --> v1([1]) --> b0
v5([1]) & v4([1]) --> b1
v6([2]) --> v5
b2[h+2] --> v4 & v6
b3[h+3] --> v9([1]) & v8([1]) & v7([1]) --> b2
b4[h+4] --> v12([2]) & v11([2]) --> v10([1]) --> b3</div><figcaption>Tree-structured voting with 3 votes per block. Block have square boxes
and are labelled with their height, votes have round boxes and are
labelled with their depth. Both votes and blocks require a
proof-of-work.</figcaption></figure><figure style=width:100%><div class=mermaid>%% Rendering this graph requires Javascript.
graph RL
b0[h]
b1[h+1] --> v3([3]) --> v2([2]) --> v1([1]) --> b0
v5([1]) & v4([1]) --> b1
v6([2]) --> v5
b2[h+2] --> v4 & v6
b3[h+3] --> v9([1]) & v8([1]) & v7([1]) --> b2
b4[h+4] --> v12([2]) & v11([2]) --> v10([1]) --> b3
classDef orphan opacity:0.5,fill:gray
ob1[h+1]:::orphan --> v3
ov1([2]):::orphan --> v4
ov2([2]):::orphan --> v10
ob4[h+4]:::orphan --> v11 & v12
linkStyle 20,21,22,23,24 opacity:0.5, stroke:gray</div><figcaption>Orphans are possible, but only when transitioning from one block to the
next. These transitions are less frequent if there are more votes per
block.</figcaption></figure><h2 id=specification>Specification <a href=#specification class=anchor aria-hidden=true>#</a></h2><p>Have a look at <a href=/cpr/docs/methods/protocol-specification/>the methodology page for protocol specification</a> to learn how to read this.</p><h3 id=parameters>Parameters <a href=#parameters class=anchor aria-hidden=true>#</a></h3><p><code>k</code>: number of proofs-of-work per blocks (or number of votes per block
plus one)</p><h3 id=blockchain>Blockchain <a href=#blockchain class=anchor aria-hidden=true>#</a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>def</span> <span class=nf>roots</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>[</span><span class=n>Block</span><span class=p>(</span><span class=n>height</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span> <span class=n>depth</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span> <span class=n>miner</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>kind</span><span class=o>=</span><span class=s2>&#34;block&#34;</span><span class=p>)]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>parent_block</span><span class=p>(</span><span class=n>b</span><span class=p>:</span> <span class=n>Block</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>b</span> <span class=o>=</span> <span class=n>b</span><span class=o>.</span><span class=n>parents</span><span class=p>()[</span><span class=mi>0</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=k>while</span> <span class=n>b</span><span class=o>.</span><span class=n>kind</span> <span class=o>!=</span> <span class=s2>&#34;block&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>b</span> <span class=o>=</span> <span class=n>b</span><span class=o>.</span><span class=n>parents</span><span class=p>()[</span><span class=mi>0</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>b</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>confirmed_votes</span><span class=p>(</span><span class=n>b</span><span class=p>:</span> <span class=n>Block</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=nb>set</span> <span class=o>=</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>p</span> <span class=ow>in</span> <span class=n>b</span><span class=o>.</span><span class=n>parents</span><span class=p>():</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>p</span><span class=o>.</span><span class=n>kind</span> <span class=o>==</span> <span class=s2>&#34;vote&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=nb>set</span> <span class=o>|=</span> <span class=p>{</span><span class=n>p</span><span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=nb>set</span> <span class=o>|=</span> <span class=n>confirmed_votes</span><span class=p>(</span><span class=n>p</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nb>set</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>confirming_votes</span><span class=p>(</span><span class=n>b</span><span class=p>:</span> <span class=n>Block</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=nb>set</span> <span class=o>=</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>c</span> <span class=ow>in</span> <span class=n>b</span><span class=o>.</span><span class=n>children</span><span class=p>():</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>c</span><span class=o>.</span><span class=n>kind</span> <span class=o>==</span> <span class=s2>&#34;vote&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=nb>set</span> <span class=o>|=</span> <span class=p>{</span><span class=n>c</span><span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=nb>set</span> <span class=o>|=</span> <span class=n>confirming_votes</span><span class=p>(</span><span class=n>c</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nb>set</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>validity</span><span class=p>(</span><span class=n>b</span><span class=p>:</span> <span class=n>Block</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>assert</span> <span class=n>b</span><span class=o>.</span><span class=n>has_pow</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>b</span><span class=o>.</span><span class=n>kind</span> <span class=o>==</span> <span class=s2>&#34;block&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>assert</span> <span class=n>b</span><span class=o>.</span><span class=n>height</span> <span class=o>==</span> <span class=n>parent_block</span><span class=p>(</span><span class=n>b</span><span class=p>)</span><span class=o>.</span><span class=n>height</span> <span class=o>+</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>        <span class=k>assert</span> <span class=n>b</span><span class=o>.</span><span class=n>depth</span> <span class=o>==</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>        <span class=k>assert</span> <span class=nb>len</span><span class=p>(</span><span class=n>confirmed_votes</span><span class=p>(</span><span class=n>b</span><span class=p>))</span> <span class=o>==</span> <span class=n>k</span> <span class=o>-</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>x</span> <span class=ow>in</span> <span class=n>confirmed_votes</span><span class=p>(</span><span class=n>b</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=k>assert</span> <span class=n>parent_block</span><span class=p>(</span><span class=n>x</span><span class=p>)</span> <span class=o>==</span> <span class=n>parent_block</span><span class=p>(</span><span class=n>b</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>elif</span> <span class=n>b</span><span class=o>.</span><span class=n>kind</span> <span class=o>==</span> <span class=s2>&#34;vote&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>parents</span> <span class=o>=</span> <span class=n>b</span><span class=o>.</span><span class=n>parents</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=k>assert</span> <span class=nb>len</span><span class=p>(</span><span class=n>parents</span><span class=p>)</span> <span class=o>==</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>        <span class=k>assert</span> <span class=n>b</span><span class=o>.</span><span class=n>depth</span> <span class=o>==</span> <span class=n>parents</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=o>.</span><span class=n>depth</span> <span class=o>+</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=kc>False</span>
</span></span></code></pre></div><h3 id=node>Node <a href=#node class=anchor aria-hidden=true>#</a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>def</span> <span class=nf>init</span><span class=p>(</span><span class=n>roots</span><span class=p>:</span> <span class=p>[</span><span class=n>Block</span><span class=p>]):</span>
</span></span><span class=line><span class=cl>    <span class=k>assert</span> <span class=nb>len</span><span class=p>(</span><span class=n>roots</span><span class=p>)</span> <span class=o>==</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>roots</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>preference</span><span class=p>(</span><span class=n>old</span><span class=p>:</span> <span class=n>Block</span><span class=p>,</span> <span class=n>new</span><span class=p>:</span> <span class=n>Block</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>new</span><span class=o>.</span><span class=n>kind</span> <span class=o>!=</span> <span class=s2>&#34;block&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>new</span> <span class=o>=</span> <span class=n>parent_block</span><span class=p>(</span><span class=n>new</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>new</span><span class=o>.</span><span class=n>height</span> <span class=o>&gt;</span> <span class=n>old</span><span class=o>.</span><span class=n>height</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>new</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>new</span><span class=o>.</span><span class=n>height</span> <span class=o>&lt;</span> <span class=n>old</span><span class=o>.</span><span class=n>height</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>old</span>
</span></span><span class=line><span class=cl>    <span class=n>old_votes</span> <span class=o>=</span> <span class=n>confirming_votes</span><span class=p>(</span><span class=n>old</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>new_votes</span> <span class=o>=</span> <span class=n>confirming_votes</span><span class=p>(</span><span class=n>new</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>new_votes</span><span class=p>)</span> <span class=o>&gt;</span> <span class=nb>len</span><span class=p>(</span><span class=n>old_votes</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>new</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>new_votes</span><span class=p>)</span> <span class=o>&lt;</span> <span class=nb>len</span><span class=p>(</span><span class=n>old_votes</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>old</span>
</span></span><span class=line><span class=cl>    <span class=n>old_depth</span> <span class=o>=</span> <span class=nb>max</span><span class=p>([</span><span class=n>x</span><span class=o>.</span><span class=n>depth</span> <span class=k>for</span> <span class=n>x</span> <span class=ow>in</span> <span class=n>old_votes</span><span class=p>])</span>
</span></span><span class=line><span class=cl>    <span class=n>new_depth</span> <span class=o>=</span> <span class=nb>max</span><span class=p>([</span><span class=n>x</span><span class=o>.</span><span class=n>depth</span> <span class=k>for</span> <span class=n>x</span> <span class=ow>in</span> <span class=n>new_votes</span><span class=p>])</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>new_depth</span> <span class=o>&gt;</span> <span class=n>old_depth</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>new</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>old</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>update</span><span class=p>(</span><span class=n>old</span><span class=p>:</span> <span class=n>Block</span><span class=p>,</span> <span class=n>new</span><span class=p>:</span> <span class=n>Block</span><span class=p>,</span> <span class=n>event</span><span class=p>:</span> <span class=n>string</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>Update</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=n>state</span><span class=o>=</span><span class=n>preference</span><span class=p>(</span><span class=n>old</span><span class=p>,</span> <span class=n>new</span><span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=n>share</span><span class=o>=</span><span class=p>[</span><span class=n>new</span><span class=p>]</span> <span class=k>if</span> <span class=n>event</span> <span class=o>==</span> <span class=s2>&#34;mining&#34;</span> <span class=k>else</span> <span class=p>[],</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>mining</span><span class=p>(</span><span class=n>b</span><span class=p>:</span> <span class=n>Block</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>vote_tree</span> <span class=o>=</span> <span class=n>confirming_votes</span><span class=p>(</span><span class=n>b</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>vote_tree</span><span class=p>)</span> <span class=o>&lt;</span> <span class=n>k</span> <span class=o>-</span> <span class=mi>1</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=c1># block infeasible; extend longest chain of votes</span>
</span></span><span class=line><span class=cl>        <span class=n>opt</span> <span class=o>=</span> <span class=n>b</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>x</span> <span class=ow>in</span> <span class=n>confirming_votes</span><span class=p>(</span><span class=n>b</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>x</span><span class=o>.</span><span class=n>depth</span> <span class=o>&gt;</span> <span class=n>opt</span><span class=o>.</span><span class=n>depth</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>opt</span> <span class=o>=</span> <span class=n>x</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>x</span><span class=o>.</span><span class=n>depth</span> <span class=o>==</span> <span class=n>opt</span><span class=o>.</span><span class=n>depth</span> <span class=ow>and</span> <span class=n>opt</span><span class=o>.</span><span class=n>miner</span> <span class=o>==</span> <span class=n>my_id</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>opt</span> <span class=o>=</span> <span class=n>x</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>Block</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>kind</span><span class=o>=</span><span class=s2>&#34;vote&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>depth</span><span class=o>=</span><span class=n>opt</span><span class=o>.</span><span class=n>depth</span> <span class=o>+</span> <span class=mi>1</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>parents</span><span class=o>=</span><span class=p>[</span><span class=n>opt</span><span class=p>],</span>
</span></span><span class=line><span class=cl>            <span class=n>miner</span><span class=o>=</span><span class=n>my_id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=c1># block feasible</span>
</span></span><span class=line><span class=cl>        <span class=c1># select leaves in vote_tree to confirm k - 1 votes</span>
</span></span><span class=line><span class=cl>        <span class=c1># while maximizing depth</span>
</span></span><span class=line><span class=cl>        <span class=n>leaves</span> <span class=o>=</span> <span class=o>...</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>Block</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>kind</span><span class=o>=</span><span class=s2>&#34;block&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>height</span><span class=o>=</span><span class=n>b</span><span class=o>.</span><span class=n>height</span> <span class=o>+</span> <span class=mi>1</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>depth</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>parents</span><span class=o>=</span><span class=n>leaves</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>miner</span><span class=o>=</span><span class=n>my_id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span></code></pre></div><h3 id=difficulty-adjustment>Difficulty Adjustment <a href=#difficulty-adjustment class=anchor aria-hidden=true>#</a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>def</span> <span class=nf>progress</span><span class=p>(</span><span class=n>b</span><span class=p>:</span> <span class=n>Block</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>b</span><span class=o>.</span><span class=n>height</span> <span class=o>*</span> <span class=n>k</span> <span class=o>+</span> <span class=n>b</span><span class=o>.</span><span class=n>depth</span>
</span></span></code></pre></div><h3 id=rewards>Rewards <a href=#rewards class=anchor aria-hidden=true>#</a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>def</span> <span class=nf>local_tip</span><span class=p>(</span><span class=n>b</span><span class=p>:</span> <span class=n>Block</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>b</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>global_tip</span><span class=p>(</span><span class=n>l</span><span class=p>:</span> <span class=p>[</span><span class=n>Block</span><span class=p>]):</span>
</span></span><span class=line><span class=cl>    <span class=n>b</span> <span class=o>=</span> <span class=n>l</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=nb>len</span><span class=p>(</span><span class=n>l</span><span class=p>)):</span>
</span></span><span class=line><span class=cl>        <span class=n>b</span> <span class=o>=</span> <span class=n>preference</span><span class=p>(</span><span class=n>b</span><span class=p>,</span> <span class=n>l</span><span class=p>[</span><span class=n>i</span><span class=p>])</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>b</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>history</span><span class=p>(</span><span class=n>b</span><span class=p>:</span> <span class=n>Block</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>h</span> <span class=o>=</span> <span class=p>[</span><span class=n>b</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=n>p</span> <span class=o>=</span> <span class=n>b</span><span class=o>.</span><span class=n>parents</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=k>while</span> <span class=n>p</span> <span class=o>!=</span> <span class=p>[]:</span>
</span></span><span class=line><span class=cl>        <span class=n>b</span> <span class=o>=</span> <span class=n>p</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>b</span><span class=o>.</span><span class=n>kind</span> <span class=o>==</span> <span class=s2>&#34;block&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>h</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>b</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>p</span> <span class=o>=</span> <span class=n>b</span><span class=o>.</span><span class=n>parents</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>h</span>
</span></span></code></pre></div><h4 id=constant-reward>Constant reward <a href=#constant-reward class=anchor aria-hidden=true>#</a></h4><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>def</span> <span class=nf>constant_reward</span><span class=p>(</span><span class=n>b</span><span class=p>:</span> <span class=n>Block</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>assert</span> <span class=n>b</span><span class=o>.</span><span class=n>kind</span> <span class=o>==</span> <span class=s2>&#34;block&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>[</span><span class=n>Reward</span><span class=p>(</span><span class=n>x</span><span class=o>.</span><span class=n>miner</span><span class=p>,</span> <span class=mi>1</span><span class=p>)</span> <span class=k>for</span> <span class=n>x</span> <span class=ow>in</span> <span class=p>{</span><span class=n>b</span><span class=p>}</span> <span class=o>|</span> <span class=n>confirming_votes</span><span class=p>(</span><span class=n>b</span><span class=p>)]</span>
</span></span></code></pre></div><figure style=width:100%><div class=mermaid>%% Rendering this graph requires Javascript.
graph RL
b0[1]
b1[1] --> v3([1]) --> v2([1]) --> v1([1]) --> b0
v5([1]) & v4([1]) --> b1
v6([1]) --> v5
b2[1] --> v4 & v6
b3[1] --> v9([1]) & v8([1]) & v7([1]) --> b2
b4[1] --> v12([1]) & v11([1]) --> v10([1]) --> b3</div><figcaption>Constant rewards make tree-structured voting equivalent to <a href=../parallel-simple>simple
parallel proof-of-work</a>.</figcaption></figure><h4 id=discount-reward>Discount reward <a href=#discount-reward class=anchor aria-hidden=true>#</a></h4><p>Tree-style voting opens up a new design space for reward functions that
take into account the depth of the vote-tree. Countless variants are
possible. We list only a few to provide an intuition.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>def</span> <span class=nf>discount0_reward</span><span class=p>(</span><span class=n>b</span><span class=p>:</span> <span class=n>Block</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>assert</span> <span class=n>b</span><span class=o>.</span><span class=n>kind</span> <span class=o>==</span> <span class=s2>&#34;block&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>d</span> <span class=o>=</span> <span class=nb>max</span><span class=p>([</span><span class=n>x</span><span class=o>.</span><span class=n>depth</span> <span class=k>for</span> <span class=n>x</span> <span class=ow>in</span> <span class=n>b</span><span class=o>.</span><span class=n>parents</span><span class=p>()])</span>
</span></span><span class=line><span class=cl>    <span class=n>r</span> <span class=o>=</span> <span class=p>(</span><span class=n>d</span> <span class=o>+</span> <span class=mi>1</span><span class=p>)</span> <span class=o>/</span> <span class=n>k</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>[</span><span class=n>Reward</span><span class=p>(</span><span class=n>x</span><span class=o>.</span><span class=n>miner</span><span class=p>,</span> <span class=n>r</span><span class=p>)</span> <span class=k>for</span> <span class=n>x</span> <span class=ow>in</span> <span class=p>{</span><span class=n>b</span><span class=p>}</span> <span class=o>|</span> <span class=n>confirmed_votes</span><span class=p>(</span><span class=n>b</span><span class=p>)]</span>
</span></span></code></pre></div><figure style=width:100%><div class=mermaid>%% Rendering this graph requires Javascript.
graph RL
b0[?]
b1[4/4] --> v3([4/4]) --> v2([4/4]) --> v1([4/4]) --> b0
v5([3/4]) & v4([3/4]) --> b1
v6([3/4]) --> v5
b2[3/4] --> v4 & v6
b3[2/4] --> v9([2/4]) & v8([2/4]) & v7([2/4]) --> b2
b4[3/4] --> v12([3/4]) & v11([3/4]) --> v10([3/4]) --> b3</div><figcaption>Non-linearity is punished proportionally to the depth of the vote-tree.
A block counts as leave in the tree of confirmed votes. We do not see
the tree of the leftmost block, thus we cannot calculate its rewards.</figcaption></figure><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>def</span> <span class=nf>discount1_reward</span><span class=p>(</span><span class=n>b</span><span class=p>:</span> <span class=n>Block</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>assert</span> <span class=n>b</span><span class=o>.</span><span class=n>kind</span> <span class=o>==</span> <span class=s2>&#34;block&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>d</span> <span class=o>=</span> <span class=nb>max</span><span class=p>([</span><span class=n>x</span><span class=o>.</span><span class=n>depth</span> <span class=k>for</span> <span class=n>x</span> <span class=ow>in</span> <span class=n>b</span><span class=o>.</span><span class=n>parents</span><span class=p>()])</span>
</span></span><span class=line><span class=cl>    <span class=n>r</span> <span class=o>=</span> <span class=p>(</span><span class=n>d</span> <span class=o>+</span> <span class=mi>1</span><span class=p>)</span> <span class=o>/</span> <span class=n>k</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>        <span class=n>Reward</span><span class=p>(</span><span class=n>x</span><span class=o>.</span><span class=n>miner</span><span class=p>,</span> <span class=n>r</span><span class=p>)</span> <span class=k>for</span> <span class=n>x</span> <span class=ow>in</span> <span class=n>confirmed_votes</span><span class=p>(</span><span class=n>b</span><span class=p>)</span> <span class=o>|</span> <span class=n>parent_block</span><span class=p>(</span><span class=n>b</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>]</span>
</span></span></code></pre></div><figure style=width:100%><div class=mermaid>%% Rendering this graph requires Javascript.
graph RL
b0[4/4]
b1[3/4] --> v3([4/4]) --> v2([4/4]) --> v1([4/4]) --> b0
v5([3/4]) & v4([3/4]) --> b1
v6([3/4]) --> v5
b2[2/4] --> v4 & v6
b3[3/4] --> v9([2/4]) & v8([2/4]) & v7([2/4]) --> b2
b4[?] --> v12([3/4]) & v11([3/4]) --> v10([3/4]) --> b3</div><figcaption>Again, non-linearity is punished proportionally to the depth of the vote-tree.
Now, a block counts as root in the tree of confirming votes. We do not see
the tree of the rightmost block, thus we cannot calculate its rewards.
Compared to the <code>discount0</code> scheme, only the blocks&rsquo; rewards change.</figcaption></figure><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>def</span> <span class=nf>discount2_reward</span><span class=p>(</span><span class=n>b</span><span class=p>:</span> <span class=n>Block</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>assert</span> <span class=n>b</span><span class=o>.</span><span class=n>kind</span> <span class=o>==</span> <span class=s2>&#34;block&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>r</span> <span class=o>=</span> <span class=nb>max</span><span class=p>([</span><span class=n>x</span><span class=o>.</span><span class=n>depth</span> <span class=k>for</span> <span class=n>x</span> <span class=ow>in</span> <span class=n>b</span><span class=o>.</span><span class=n>parents</span><span class=p>()])</span> <span class=o>/</span> <span class=n>k</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>[</span><span class=n>Reward</span><span class=p>(</span><span class=n>b</span><span class=o>.</span><span class=n>miner</span><span class=p>,</span> <span class=mi>1</span><span class=p>)]</span> <span class=o>+</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>        <span class=n>Reward</span><span class=p>(</span><span class=n>x</span><span class=o>.</span><span class=n>miner</span><span class=p>,</span> <span class=n>r</span><span class=p>)</span> <span class=k>for</span> <span class=n>x</span> <span class=ow>in</span> <span class=n>confirmed_votes</span><span class=p>(</span><span class=n>b</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>]</span>
</span></span></code></pre></div><figure style=width:100%><div class=mermaid>%% Rendering this graph requires Javascript.
graph RL
b0[1]
b1[1] --> v3([3/3]) --> v2([3/3]) --> v1([3/3]) --> b0
v5([2/3]) & v4([2/3]) --> b1
v6([2/3]) --> v5
b2[1] --> v4 & v6
b3[1] --> v9([1/3]) & v8([1/3]) & v7([1/3]) --> b2
b4[1] --> v12([2/3]) & v11([2/3]) --> v10([2/3]) --> b3</div><figcaption>Still, non-linearity is punished proportionally to the depth of the vote-tree.
Now, the depth-based discount applies to votes only while blocks get
constant rewards.</figcaption></figure><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>def</span> <span class=nf>discount3_reward</span><span class=p>(</span><span class=n>b</span><span class=p>:</span> <span class=n>Block</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>assert</span> <span class=n>b</span><span class=o>.</span><span class=n>kind</span> <span class=o>==</span> <span class=s2>&#34;block&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>r</span> <span class=o>=</span> <span class=nb>max</span><span class=p>([</span><span class=n>x</span><span class=o>.</span><span class=n>depth</span> <span class=k>for</span> <span class=n>x</span> <span class=ow>in</span> <span class=n>b</span><span class=o>.</span><span class=n>parents</span><span class=p>()])</span> <span class=o>/</span> <span class=n>k</span>
</span></span><span class=line><span class=cl>    <span class=n>block_rewards</span> <span class=o>=</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>        <span class=n>Reward</span><span class=p>(</span><span class=n>b</span><span class=o>.</span><span class=n>miner</span><span class=p>,</span> <span class=n>r</span> <span class=o>/</span> <span class=mi>2</span><span class=p>)</span> <span class=k>for</span> <span class=n>x</span> <span class=ow>in</span> <span class=p>[</span><span class=n>b</span><span class=p>,</span> <span class=n>parent_block</span><span class=p>(</span><span class=n>b</span><span class=p>)]</span>
</span></span><span class=line><span class=cl>    <span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=n>vote_rewards</span> <span class=o>=</span> <span class=p>[</span><span class=n>Reward</span><span class=p>(</span><span class=n>x</span><span class=o>.</span><span class=n>miner</span><span class=p>,</span> <span class=n>r</span><span class=p>)</span> <span class=k>for</span> <span class=n>x</span> <span class=ow>in</span> <span class=n>confirmed_votes</span><span class=p>(</span><span class=n>b</span><span class=p>)]</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>block_rewards</span> <span class=o>+</span> <span class=n>vote_rewards</span>
</span></span></code></pre></div><figure style=width:100%><div class=mermaid>%% Rendering this graph requires Javascript.
graph RL
b0[?]
b1[5/6] --> v3([3/3]) --> v2([3/3]) --> v1([3/3]) --> b0
v5([2/3]) & v4([2/3]) --> b1
v6([2/3]) --> v5
b2[3/6] --> v4 & v6
b3[3/6] --> v9([1/3]) & v8([1/3]) & v7([1/3]) --> b2
b4[?] --> v12([2/3]) & v11([2/3]) --> v10([2/3]) --> b3</div><figcaption>As before, non-linearity is punished proportionally to the depth of the
vote-tree. The depth-based discount applies to votes like in the
<code>discount2</code> scheme. Here, blocks do not get constant reward but the mean
of confirmed and confirming votes. We cannot calculate the rewards for
the outermost blocks because they depend on unobserved parts of the
blockchain.</figcaption></figure><p>Needless to say, other hybrids are possible. Tree-structured voting
opens up a whole design space for blockchain incentive schemes.</p><h2 id=literature>Literature <a href=#literature class=anchor aria-hidden=true>#</a></h2><p>Some sort of tree-structured voting in present in Bobtail, altough it
does not discount rewards depending on the tree structure. Alzayat et
al. analyse the inequality of <a href=../nakamoto>Nakamoto consensus</a> which is
the main motivation for the discount reward scheme presented here.</p><ul><li>George Bissias and Brian N. Levine. Bobtail: Improved Blockchain
Security with Low-Variance Mining. NDSS &lsquo;22.
<a href=https://www.ndss-symposium.org/ndss-paper/bobtail-improved-blockchain-security-with-low-variance-mining/>[publisher]</a></li><li>Mohamed Alzayat and others. Modeling Coordinated vs. P2P Mining: An Analysis of Inefficiency and
Inequality in Proof-of-Work Blockchains.
<a href=https://arxiv.org/pdf/2106.02970.pdf>[preprint]</a></li></ul><div class="page-footer-meta d-flex flex-column flex-md-row justify-content-between"><div class=last-modified><a href=https://github.com/pkel/cpr/commit/01223aa31c7929213d50d8e2e162d129ab24da67><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>Last modified on December 12, 2022</a></div><div class=edit-page><a href=https://github.com/pkel/cpr/blob/website/website/content/en/docs/protocols/parallel-tree.md><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-edit-2"><path d="M17 3a2.828 2.828.0 114 4L7.5 20.5 2 22l1.5-5.5L17 3z"/></svg>Edit this page on GitHub</a></div></div><div class="docs-navigation d-flex justify-content-between"><a href=/cpr/docs/protocols/parallel-aft22/><div class="card my-1"><div class="card-body py-2">&larr; Parallel PoW (AFT '22)</div></div></a><a class=ms-auto href=/cpr/docs/protocols/tailstorm/><div class="card my-1"><div class="card-body py-2">Tailstorm &rarr;</div></div></a></div></main></div></div></div><footer class="footer text-muted"><div class=container-xxl><div class=row><div class="col-lg-8 order-last order-lg-first"><ul class=list-inline><li class=list-inline-item>Powered by <a class=text-muted href=https://gohugo.io/>Hugo</a> and <a class=text-muted href=https://getdoks.org/>Doks</a></li></ul></div><div class="col-lg-8 order-first order-lg-last text-lg-end"><ul class=list-inline></ul></div></div></div></footer><script src=/cpr/js/bootstrap.min.87685cf4e6585276ff9e7b5d0b97e792615af6921e77821315d1ca7c5511ac2f30667e16c0d031e680ca8b57f63f6c0f6c4a232da777cce474b501ed81e090a9.js integrity="sha512-h2hc9OZYUnb/nntdC5fnkmFa9pIed4ITFdHKfFURrC8wZn4WwNAx5oDKi1f2P2wPbEojLad3zOR0tQHtgeCQqQ==" crossorigin=anonymous defer></script>
<script src=/cpr/js/highlight.min.56a414730f1135fe77b5ea30bf74a2cc4101a6f386e85e5b789c800570cc33d33054000f45932c053a59b41018f72687867254a80e1b9710671852492533162f.js integrity="sha512-VqQUcw8RNf53teowv3SizEEBpvOG6F5beJyABXDMM9MwVAAPRZMsBTpZtBAY9yaHhnJUqA4blxBnGFJJJTMWLw==" crossorigin=anonymous defer></script>
<script src=/cpr/js/vendor/katex/dist/katex.min.ed3f25b49c13f756d6454d3bfdc2090afae6101a06312e6bd27f154380b31c955bb4615215ef7518b270b4f9013bc757ffa2587509afd55cbf98bdd4e06064b3.js integrity="sha512-7T8ltJwT91bWRU07/cIJCvrmEBoGMS5r0n8VQ4CzHJVbtGFSFe91GLJwtPkBO8dX/6JYdQmv1Vy/mL3U4GBksw==" crossorigin=anonymous defer></script>
<script src=/cpr/js/vendor/katex/dist/contrib/auto-render.min.f128dc24877a8ff5cdc694570f6cd25f8ad512d4330c242487c4cbbc5dc6fd2c52de778da1e59f98585d1defd5aa5aa583da59e90e6837973ecca3b45b01fb64.js integrity="sha512-8SjcJId6j/XNxpRXD2zSX4rVEtQzDCQkh8TLvF3G/SxS3neNoeWfmFhdHe/Vqlqlg9pZ6Q5oN5c+zKO0WwH7ZA==" crossorigin=anonymous defer></script>
<script src=/cpr/main.min.80955c2493e9d609475fb10842203909740aa1ae5acc06839b9856bc850fe619b527f38c4750aecaf8c54bd50282dc661b31b6973a1d77405c6d9d9c552a9c8c.js integrity="sha512-gJVcJJPp1glHX7EIQiA5CXQKoa5azAaDm5hWvIUP5hm1J/OMR1CuyvjFS9UCgtxmGzG2lzodd0BcbZ2cVSqcjA==" crossorigin=anonymous defer></script>
<script src=/cpr/js/mermaid.min.402b3ef4a812bab1460b2623191b7e1bed58adf94f9104432f2f8dea131061b21af41987b017cec9bbd0ceab64a0335904a40b8d639af05e754bc978247ef225.js integrity="sha512-QCs+9KgSurFGCyYjGRt+G+1YrflPkQRDLy+N6hMQYbIa9BmHsBfOybvQzqtkoDNZBKQLjWOa8F51S8l4JH7yJQ==" crossorigin=anonymous defer></script>
<script src=https://pkel.github.io/cpr/index.min.90ead642267b48e175d85029a946206be7f23b446815083ba350428e6d2b165de3bbd945bb157cd99002a19cb33e79963684150450867730dd337123c747d75d.js integrity="sha512-kOrWQiZ7SOF12FApqUYga+fyO0RoFQg7o1BCjm0rFl3ju9lFuxV82ZACoZyzPnmWNoQVBFCGdzDdM3Ejx0fXXQ==" crossorigin=anonymous defer></script></body></html>